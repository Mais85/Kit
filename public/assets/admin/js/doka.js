!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";var i=n(1);window.dokaCreate=i.create},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==c(Symbol.iterator)?function(t){return void 0===t?"undefined":c(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":c(t)})(t)}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){r(t,e,n[e])})}return t}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Object.defineProperty(e,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(t,e){return e.parentNode.insertBefore(t,e)},l=function(t,e){return e.parentNode.insertBefore(t,e.nextSibling)},s=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},f=function(t){var e={};return s(t,function(n){!function(t,e,n){"function"!=typeof n?Object.defineProperty(t,e,n):t[e]=n}(e,n,t[n])}),e},d=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===n)return t.getAttribute(e)||t.hasAttribute(e);t.setAttribute(e,n)},h=["svg","path"],p=function(t){return h.includes(t)},m=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===i(e)&&(n=e,e=null);var r=p(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);return e&&(p(t)?d(r,"class",e):r.className=e),s(n,function(t,e){d(r,t,e)}),r},g=function(t,e,n,i){var r=n[0]||t.left,a=n[1]||t.top,c=r+t.width,u=a+t.height*(i[1]||1),l={element:o({},t),inner:{left:t.left,top:t.top,right:t.right,bottom:t.bottom},outer:{left:r,top:a,right:c,bottom:u}};return e.filter(function(t){return!t.isRectIgnored()}).map(function(t){return t.rect}).forEach(function(t){v(l.inner,o({},t.inner)),v(l.outer,o({},t.outer))}),y(l.inner),l.outer.bottom+=l.element.marginBottom,l.outer.right+=l.element.marginRight,y(l.outer),l},v=function(t,e){e.top+=t.top,e.right+=t.left,e.bottom+=t.top,e.left+=t.left,e.bottom>t.bottom&&(t.bottom=e.bottom),e.right>t.right&&(t.right=e.right)},y=function(t){t.width=t.right-t.left,t.height=t.bottom-t.top},E=function(t){return"number"==typeof t},_=function(t){return t<.5?2*t*t:(4-2*t)*t-1},w={spring:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.stiffness,n=void 0===e?.5:e,i=t.damping,r=void 0===i?.75:i,o=t.mass,a=void 0===o?10:o,c=t.delay,u=void 0===c?0:c,l=null,s=null,d=0,h=!1,p=null,m=f({interpolate:function(t){if(null===p&&(p=t),!(t-u<p||h)){if(!E(l)||!E(s))return h=!0,void(d=0);!function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;return Math.abs(t-e)<i&&Math.abs(n)<i}(s+=d+=-(s-l)*n/a,l,d*=r)?m.onupdate(s):(s=l,d=0,h=!0,m.onupdate(s),m.oncomplete(s))}},target:{set:function(t){if(E(t)&&!E(s)&&(s=t,p=null),null===l&&(l=t,s=t,p=null),h&&(p=null),s===(l=t)||void 0===l)return h=!0,d=0,p=null,m.onupdate(s),void m.oncomplete(s);h=!1},get:function(){return l}},resting:{get:function(){return h}},onupdate:function(t){},oncomplete:function(t){}});return m},tween:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.duration,r=void 0===i?500:i,o=n.easing,a=void 0===o?_:o,c=n.delay,u=void 0===c?0:c,l=null,s=!0,d=!1,h=null,p=f({interpolate:function(n){s||null===h||(null===l&&(l=n),n-l<u||((t=n-l-u)<r?(e=t/r,p.onupdate((t>=0?a(d?1-e:e):0)*h)):(t=1,e=d?0:1,p.onupdate(e*h),p.oncomplete(e*h),s=!0)))},target:{get:function(){return d?0:h},set:function(t){if(null===h)return h=t,p.onupdate(t),void p.oncomplete(t);t<h?(h=1,d=!0):(d=!1,h=t),s=!1,l=null}},resting:{get:function(){return s}},onupdate:function(t){},oncomplete:function(t){}});return p}},x=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(e=Array.isArray(e)?e:[e]).forEach(function(e){t.forEach(function(t){var o=t,a=function(){return n[t]},c=function(e){return n[t]=e};"object"===i(t)&&(o=t.key,a=t.getter||a,c=t.setter||c),e[o]&&!r||(e[o]={get:a,set:c})})})},T=function(t){return null!=t},R={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},A=function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!0;for(var n in e)if(e[n]!==t[n])return!0;return!1},I=function(t,e){var n=e.opacity,i=e.perspective,r=e.translateX,o=e.translateY,a=e.scaleX,c=e.scaleY,u=e.rotateX,l=e.rotateY,s=e.rotateZ,f=e.originX,d=e.originY,h=e.width,p=e.height,m="",g="";(T(f)||T(d))&&(g+="transform-origin: ".concat(f||0,"px ").concat(d||0,"px;")),T(i)&&(m+="perspective(".concat(i,"px) ")),(T(r)||T(o))&&(m+="translate3d(".concat(r||0,"px, ").concat(o||0,"px, 0) ")),(T(a)||T(c))&&(m+="scale3d(".concat(T(a)?a:1,", ").concat(T(c)?c:1,", 1) ")),T(s)&&(m+="rotateZ(".concat(s,"rad) ")),T(u)&&(m+="rotateX(".concat(u,"rad) ")),T(l)&&(m+="rotateY(".concat(l,"rad) ")),m.length&&(g+="transform:".concat(m,";")),T(n)&&(g+="opacity:".concat(n,";"),0===n&&"BUTTON"===t.nodeName&&(g+="visibility:hidden;"),n<1&&(g+="pointer-events:none;")),T(p)&&(g+="height:".concat(p,"px;")),T(h)&&(g+="width:".concat(h,"px;"));var v=t.elementCurrentStyle||"";g.length===v.length&&g===v||(t.setAttribute("style",g),t.elementCurrentStyle=g)},C={styles:function(t){var e=t.mixinConfig,n=t.viewProps,i=t.viewInternalAPI,r=t.viewExternalAPI,a=t.view,c=o({},n),u={};x(e,[i,r],n);var l=function(){return a.rect?g(a.rect,a.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return i.rect={get:l},r.rect={get:l},e.forEach(function(t){n[t]=void 0===c[t]?R[t]:c[t]}),{write:function(){if(A(u,n))return I(a.element,n),Object.assign(u,o({},n)),!0},destroy:function(){}}},listeners:function(t){var e=t.viewExternalAPI,n=t.view,i=[],r=function(t){return function(e,n){t.addEventListener(e,n)}}(n.element),o=function(t){return function(e,n){t.removeEventListener(e,n)}}(n.element);return e.on=function(t,e){i.push({type:t,fn:e}),r(t,e)},e.off=function(t,e){i.splice(i.findIndex(function(n){return n.type===t&&n.fn===e}),1),o(t,e)},{write:function(){return!0},destroy:function(){i.forEach(function(t){o(t.type,t.fn)})}}},animations:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,a=t.viewExternalAPI,c=(t.viewState,o({},n)),u=[];return s(e,function(t,e){var l=function(t,e,n){var r=t[e]&&"object"===i(t[e][n])?t[e][n]:t[e]||t,a="string"==typeof r?r:r.type,c="object"===i(r)?o({},r):{};return w[a]?w[a](c):null}(e);l&&(l.onupdate=function(e){n[t]=e},l.target=c[t],x([{key:t,setter:function(t){l.target!==t&&(l.target=t)},getter:function(){return n[t]}}],[r,a],n,!0),u.push(l))}),{write:function(t){var e=!0;return u.forEach(function(n){n.resting||(e=!1),n.interpolate(t)}),e},destroy:function(){}}},apis:function(t){var e=t.mixinConfig,n=t.viewProps,i=t.viewExternalAPI;x(e,i,n)}},M=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.layoutCalculated||(t.paddingTop=parseInt(n.paddingTop,10)||0,t.marginTop=parseInt(n.marginTop,10)||0,t.marginRight=parseInt(n.marginRight,10)||0,t.marginBottom=parseInt(n.marginBottom,10)||0,t.marginLeft=parseInt(n.marginLeft,10)||0,e.layoutCalculated=!0),t.left=e.offsetLeft||0,t.top=e.offsetTop||0,t.width=e.offsetWidth||0,t.height=e.offsetHeight||0,t.right=t.left+t.width,t.bottom=t.top+t.height,t.scrollTop=e.scrollTop,t.hidden=null===e.offsetParent&&"fixed"!==n.position,t},O=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tag,n=void 0===e?"div":e,i=t.name,r=void 0===i?null:i,a=t.attributes,c=void 0===a?{}:a,u=t.read,l=void 0===u?function(){}:u,s=t.write,d=void 0===s?function(){}:s,h=t.create,p=void 0===h?function(){}:h,v=t.destroy,y=void 0===v?function(){}:v,E=t.filterFrameActionsForChild,_=void 0===E?function(t,e){return e}:E,w=t.didCreateView,x=void 0===w?function(){}:w,T=t.didWriteView,R=void 0===T?function(){}:T,A=t.ignoreRect,I=void 0!==A&&A,O=t.ignoreRectUpdate,b=void 0!==O&&O,P=t.mixins,L=void 0===P?[]:P;return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=m(n,r?"doka--".concat(r):null,c),a=window.getComputedStyle(i,null),u=M(),s=null,h=!1,v=[],E=[],w={},T={},A=[d],O=[l],P=[y],S=function(){return i},G=function(){return v.concat()},D=function(){return s||(s=g(u,v,[0,0],[1,1]))},U=function(){return i.layoutCalculated=!1},V={element:{get:S},style:{get:function(){return a}},childViews:{get:G}},k=o({},V,{rect:{get:D},ref:{get:function(){return w}},is:function(t){return r===t},appendChild:function(t){return function(e,n){void 0!==n&&t.children[n]?t.insertBefore(e,t.children[n]):t.appendChild(e)}}(i),createChildView:function(t){return function(e,n){return e(t,n)}}(t),linkView:function(t){return v.push(t),t},unlinkView:function(t){v.splice(v.indexOf(t),1)},appendChildView:function(t,e){return function(t,n){return void 0!==n?e.splice(n,0,t):e.push(t),t}}(0,v),removeChildView:function(t,e){return function(n){return e.splice(e.indexOf(n),1),n.element.parentNode&&t.removeChild(n.element),n}}(i,v),registerWriter:function(t){return A.push(t)},registerReader:function(t){return O.push(t)},registerDestroyer:function(t){return P.push(t)},invalidateLayout:U,dispatch:t.dispatch,query:t.query}),N={element:{get:S},childViews:{get:G},rect:{get:D},resting:{get:function(){return h}},isRectIgnored:function(){return I},invalidateLayout:U,_read:function(){s=null,v.forEach(function(t){return t._read()}),!(b&&u.width&&u.height)&&M(u,i,a);var t={root:B,props:e,rect:u};O.forEach(function(e){return e(t)})},_write:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=0===n.length;return A.forEach(function(r){!1===r({props:e,root:B,actions:n,timestamp:t})&&(i=!1)}),E.forEach(function(e){!1===e.write(t)&&(i=!1)}),v.filter(function(t){return!!t.element.parentNode}).forEach(function(e){e._write(t,_(e,n))||(i=!1)}),v.forEach(function(e,r){e.element.parentNode||(B.appendChild(e.element,r),e._read(),e._write(t,_(e,n)),i=!1)}),h=i,R({props:e,root:B,actions:n,timestamp:t}),i},_destroy:function(){E.forEach(function(t){return t.destroy()}),P.forEach(function(t){t({root:B})}),v.forEach(function(t){return t._destroy()})}},z=o({},V,{rect:{get:function(){return u}}});Object.keys(L).sort(function(t,e){return"styles"===t?1:"styles"===e?-1:0}).forEach(function(t){var n=C[t]({mixinConfig:L[t],viewProps:e,viewState:T,viewInternalAPI:k,viewExternalAPI:N,view:f(z)});n&&E.push(n)});var B=f(k);p({root:B,props:e});var Y=(i.children||[]).length;return v.forEach(function(t,e){B.appendChild(t.element,Y+e)}),x(B),f(N)}},b=function(t,e){return function(n){var i=n.root,r=n.props,o=n.actions,a=void 0===o?[]:o,c=n.timestamp;a.filter(function(e){return t[e.type]}).forEach(function(e){return t[e.type]({root:i,props:r,action:e.data,timestamp:c})}),e&&e({root:i,props:r,actions:a,timestamp:c})}},P=function(t){return Array.isArray(t)},L=function(t){return null==t},S=function(t){return t.trim()},G=function(t){return""+t},D=function(t){return"boolean"==typeof t},U=function(t){return"string"==typeof t},V=function(t){return E(t)?t:U(t)?G(t).replace(/[a-z]+/gi,""):0},k=function(t){return parseInt(V(t),10)},N=function(t){return E(t)&&isFinite(t)&&Math.floor(t)===t},z=function(t){if(N(t))return t;var e=G(t).trim();return/MB$/i.test(e)?(e=e.replace(/MB$i/,"").trim(),1e3*k(e)*1e3):/KB/i.test(e)?(e=e.replace(/KB$i/,"").trim(),1e3*k(e)):k(e)},B=function(t){return P(t)?"array":function(t){return null===t}(t)?"null":N(t)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(t)?"bytes":i(t)},Y={array:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return L(t)?[]:P(t)?t:G(t).split(e).map(S).filter(function(t){return t.length})},boolean:function(t){return D(t)?t:"true"===t},int:function(t){return"bytes"===B(t)?z(t):k(t)},float:function(t){return parseFloat(V(t))},bytes:z,string:function(t){return function(t){return"function"==typeof t}(t)?t:G(t)},object:function(t){try{return JSON.parse(function(t){return t.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",')}(t))}catch(e){return t}},file:function(t){return t},function:function(t){return function(t){for(var e=self,n=t.split("."),i=null;i=n.shift();)if(!(e=e[i]))return null;return e}(t)}},X=function(t,e,n){if(t===e)return t;var i=B(t);if(i!==n){var r=function(t,e){return Y[e](t)}(t,n);if(i=B(r),null===r)throw'Trying to assign value with incorrect type to "'.concat(option,'", allowed type: "').concat(n,'"');t=r}return t},W=function(t){var e={};return s(t,function(n){var i=U(t[n])?t[n]:n,r=t[i];e[n]=i===n?function(t,e){var n=t;return{enumerable:!0,get:function(){return n},set:function(i){n=X(i,t,e)}}}(r[0],r[1]):e[i]}),f(e)},Z=function(t){t.file=null,t.activeView=null,t.rootRect={x:0,y:0,left:0,top:0,width:0,height:0},t.stage=null,t.stageOffset=null,t.image=null,t.zoomTimeoutId=null,t.instantUpdate=!1,t.filePromise=null,t.fileLoader=null,t.instructions={size:null,crop:null},t.size={width:!1,height:!1,aspectRatioLocked:!0,aspectRatioPrevious:!1},t.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,draft:{rectangle:null,transforms:null}}},q=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(/(?=[A-Z])/).map(function(t){return t.toLowerCase()}).join(e)},H=function(t,e){t!==e&&console.warn("'".concat(t,"' is deprecated, please use '").concat(e,"' instead."))},F=function(){return Math.random().toString(36).substr(2,9)},j=function(){var t=[],e=function(e,n){!function(t,e){t.splice(e,1)}(t,t.findIndex(function(t){return t.event===e&&(t.cb===n||!n)}))};return{fire:function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.filter(function(t){return t.event===e}).map(function(t){return t.cb}).forEach(function(t){setTimeout(function(){t.apply(void 0,i)},0)})},on:function(e,n){t.push({event:e,cb:n})},onOnce:function(n,i){t.push({event:n,cb:function(){e(n,i),i.apply(void 0,arguments)}})},off:e}},Q="boolean",K="int",J="string",$="array",tt="object",et="function",nt="file",it="undefined"!=typeof window&&void 0!==window.document,rt=function(){return it},ot=function(){return o({},ct)},at=function(t,e){t=function(t){return U(ct[t])?ct[t]:t}(t),ct[t][0]=X(e,ct[t][0],ct[t][1])},ct={id:[null,J],className:[null,J],src:[null,nt],maxImagePreviewWidth:[1500,K],maxImagePreviewHeight:[1500,K],allowButtonCancel:[!0,Q],allowButtonConfirm:[!0,Q],allowDropFiles:[!1,Q],allowAutoClose:[!0,Q],allowAutoDestroy:[!1,Q],utils:[["crop"],$],outputData:[!1,Q],outputFile:[!0,Q],outputStripImageHead:[!0,Q],outputType:[null,J],outputQuality:[null,K],outputFit:["cover",J],outputUpscale:[!0,Q],outputWidth:[null,K],outputHeight:[null,K],size:[null,tt],sizeMin:[{width:1,height:1},tt],sizeMax:[{width:9999,height:9999},tt],crop:[null,tt],cropShowSize:[!1,Q],cropZoomTimeout:[null,K],cropMask:[null,et],cropMaskInset:[0,K],cropAllowImageTurnRight:[!1,Q],cropResizeKeyCodes:[[18,91,92,93],$],cropAspectRatio:[null,J],cropAspectRatioOptions:[null,$],cropMinImageWidth:[1,K],cropMinImageHeight:[1,K],beforeCreateBlob:[null,et],onconfirm:[null,et],oncancel:[null,et],onclose:[null,et],onload:[null,et],oninit:[null,et],ondestroy:[null,et],labelButtonReset:["Reset",J],labelButtonCancel:["Cancel",J],labelButtonConfirm:["Done",J],labelButtonUtilCrop:["Crop",J],labelButtonUtilResize:["Resize",J],labelStatusAwaitingImage:["Waiting for image…",J],labelStatusLoadImageError:["Error loading image…",J],labelStatusLoadingImage:["Loading image…",J],labelStatusProcessingImage:["Processing image…",J],labelButtonCropZoom:["Zoom",J],labelButtonCropRotateLeft:["Rotate left",J],labelButtonCropRotateRight:["Rotate right",J],labelButtonCropRotateCenter:["Center rotation",J],labelButtonCropFlipHorizontal:["Flip horizontal",J],labelButtonCropFlipVertical:["Flip vertical",J],labelButtonCropAspectRatio:["Aspect ratio",J],styleFullscreenSafeArea:[rt()&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",J],styleLayoutMode:[null,J]},ut=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},lt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return parseFloat(t.toFixed(e))},st=function(t,e){return{x:lt(t.x,e),y:lt(t.y,e)}},ft=function(t,e){return mt(t.x-e.x,t.y-e.y)},dt=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(ft(t,e),ft(t,e))}(t,e))},ht=function(t,e){return mt(ut(t.x,e.x,e.x+e.width),ut(t.y,e.y,e.y+e.height))},pt=function(t,e,n){var i=Math.cos(e),r=Math.sin(e),o=mt(t.x-n.x,t.y-n.y);return mt(n.x+i*o.x-r*o.y,n.y+r*o.x+i*o.y)},mt=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},gt=function(t,e){return Tt(t.x+e.x,t.y+e.y,t.width,t.height)},vt={translate:gt,rotate:function(t,e,n){var i=function(t,e,n){return 0===e?{tl:t.tl,tr:t.tr,br:t.br,bl:t.bl}:{tl:pt(t.tl,e,n),tr:pt(t.tr,e,n),br:pt(t.br,e,n),bl:pt(t.bl,e,n)}}(xt(t),e,n),r=i.tl,o=i.tr,a=i.br,c=i.bl,u=Math.min(r.x,o.x,a.x,c.x),l=Math.min(r.y,o.y,a.y,c.y),s=Math.max(r.x,o.x,a.x,c.x),f=Math.max(r.y,o.y,a.y,c.y);return Tt(u,l,s-u,f-l)},scale:function(t,e,n){return Tt(e*(t.x-n.x)+n.x,e*(t.y-n.y)+n.y,e*t.width,e*t.height)}},yt=function(t){return Tt(t.x,t.y,t.width,t.height)},Et=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},_t=function(t){var e=t.top,n=t.right,i=t.bottom,r=t.left;return{x:r,y:e,width:n-r,height:i-e}},wt=function(t){return mt(t.x+.5*t.width,t.y+.5*t.height)},xt=function(t){return{tl:{x:t.x,y:t.y},tr:{x:t.x+t.width,y:t.y},br:{x:t.x+t.width,y:t.y+t.height},bl:{x:t.x,y:t.y+t.height}}},Tt=function(t,e,n,i){return{x:t,y:e,width:n,height:i}},Rt=function(t){if(L(t))return t;if(/:/.test(t)){var e=t.split(":"),n=e[0];return e[1]/n}return parseFloat(t)},At=function(t,e){var n=t.width,i=n*e;return i>t.height&&(n=(i=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-i),width:n,height:i}},It=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.height/t.width,r=e,o=1,a=i;a>r&&(o=(a=r)/i);var c=Math.max(1/o,r/a),u=t.width/(n*c*o);return{width:u,height:u*e}},Ct=function(t,e){return{x:t,y:e}},Mt=function(t,e){return Ct(t.x-e.x,t.y-e.y)},Ot=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(Mt(t,e),Mt(t,e))}(t,e))},bt=function(t,e){var n=t,i=e,r=1.5707963267948966-e,o=Math.sin(1.5707963267948966),a=Math.sin(i),c=Math.sin(r),u=Math.cos(r),l=n/o;return Ct(u*(l*a),u*(l*c))},Pt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},r=i.x>.5?1-i.x:i.x,o=i.y>.5?1-i.y:i.y,a=2*r*t.width,c=2*o*t.height,u=function(t,e){var n=t.width,i=t.height,r=bt(n,e),o=bt(i,e),a=Ct(t.x+Math.abs(r.x),t.y-Math.abs(r.y)),c=Ct(t.x+t.width+Math.abs(o.y),t.y+Math.abs(o.x)),u=Ct(t.x-Math.abs(o.y),t.y+t.height-Math.abs(o.x));return{width:Ot(a,c),height:Ot(a,u)}}(e,n);return Math.max(u.width/a,u.height/c)},Lt=function(t,e){var n=e.origin,i=e.translation;return function(t,e,n){return e.reduce(function(t,e){return(0,vt[e[0]])(t,e[1],n)},t)}(t,[["scale",e.scale],["translate",i]],n)},St=function(t,e){var n=t,i=e,r=1.5707963267948966-e,o=Math.sin(1.5707963267948966),a=Math.sin(i),c=Math.sin(r),u=Math.cos(r),l=n/o;return mt(u*(l*a),u*(l*c))},Gt=function(t,e){var n=t.width,i=t.height,r=e%(Math.PI/2),o=St(n,r),a=St(i,r),c=xt(t);return{tl:mt(c.tl.x+Math.abs(o.x),c.tl.y-Math.abs(o.y)),tr:mt(c.tr.x+Math.abs(a.y),c.tr.y+Math.abs(a.x)),br:mt(c.br.x-Math.abs(o.x),c.br.y+Math.abs(o.y)),bl:mt(c.bl.x-Math.abs(a.y),c.bl.y-Math.abs(a.x))}},Dt=function(t,e,n){var i=n.origin,r=n.translation,o=Lt(t,n),a={x:i.x+r.x,y:i.y+r.y},c=2*Math.PI+n.rotation%(2*Math.PI),u=Gt(e,c),l=pt(u.tl,-c,a),s=pt(u.tr,-c,a),f=pt(u.br,-c,a),d={x:Math.min(l.x,s.x,f.x),y:Math.min(l.y,s.y,f.y),width:Math.max(l.x,s.x,f.x)-Math.min(l.x,s.x,f.x),height:Math.max(l.y,s.y,f.y)-Math.min(l.y,s.y,f.y)},h=Tt(d.x,d.y,d.width,d.height),p=wt(h),m=e.height/e.width,g={x:(p.x-o.x)/o.width,y:(p.y-o.y)/o.height},v=g.y>.5?1-g.y:g.y,y=2*(g.x>.5?1-g.x:g.x)*o.width,E=2*v*o.height;return{center:g,zoom:Math.min(y/h.width,E/h.height),rotation:n.rotation,aspectRatio:m}},Ut=function(t,e){var n=Vt(t,e);return{center:{x:lt(n.center.x),y:lt(n.center.y)},rotation:lt(n.rotation),zoom:lt(n.zoom),aspectRatio:lt(n.aspectRatio),flip:o({},e.flip)}},Vt=function(t,e){var n=Dt(t,e.rectangle,e.transforms);return{center:{x:n.center.x,y:n.center.y},rotation:n.rotation,zoom:n.zoom,aspectRatio:n.aspectRatio,flip:o({},e.flip)}},kt=[],Nt=function(t){return t.crop.draft.transforms?t.crop.draft.transforms.scale:t.crop.transforms.scale},zt=function(t){var e=t.image.width/t.image.naturalWidth,n=Nt(t);return{width:t.options.cropMinImageWidth*n*e,height:t.options.cropMinImageHeight*n*e}},Bt=function(t){var e=Nt(t);return{width:t.image.width*e,height:t.image.height*e}},Yt=function(t){return t.options.cropAspectRatioOptions?t.options.cropAspectRatioOptions.map(function(t){return{label:t.label,value:t.value?Rt(t.value):null}}):null},Xt=function(t){return{ALLOW_MANUAL_RESIZE:function(){return t.options.utils.includes("resize")},GET_SIZE:function(){return function(t){return!1!==t.size.width&&!1!==t.size.height?{width:t.size.width,height:t.size.height}:t.instructions.size?{width:t.instructions.size.width,height:t.instructions.size.height}:{width:null,height:null}}(t)},GET_SIZE_INPUT:function(){return{width:t.size.width,height:t.size.height}},GET_SIZE_ASPECT_RATIO_LOCK:function(){return t.size.aspectRatioLocked},IS_ACTIVE_VIEW:function(e){return t.activeView===e},GET_STYLES:function(){return Object.keys(t.options).filter(function(t){return/^style/.test(t)}).map(function(e){return{name:e,value:t.options[e]}})},GET_FILE:function(){return t.file},GET_IMAGE:function(){return t.image},GET_STAGE:function(){return o({},t.stage,t.stageOffset)},GET_ROOT:function(){return t.rootRect},GET_MIN_IMAGE_SIZE:function(){return{width:t.options.cropMinImageWidth,height:t.options.cropMinImageHeight}},GET_IMAGE_PREVIEW_SCALE_FACTOR:function(){return t.image.width/t.image.naturalWidth},GET_MIN_PREVIEW_IMAGE_SIZE:function(){var e=t.image.width/t.image.naturalWidth;return{width:t.options.cropMinImageWidth*e,height:t.options.cropMinImageHeight*e}},GET_MIN_CROP_SIZE:function(){return zt(t)},GET_MAX_CROP_SIZE:function(){return Bt(t)},GET_MIN_PIXEL_CROP_SIZE:function(){var e=t.crop.transforms.scale,n=zt(t);return{width:n.width/e,height:n.height/e}},GET_MAX_PIXEL_CROP_SIZE:function(){var e=t.crop.transforms.scale,n=Bt(t);return{width:n.width/e,height:n.height/e}},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return Yt(t)},GET_ACTIVE_CROP_ASPECT_RATIO:function(){var e=t.crop.aspectRatio;return U(e)?Rt(e):e},GET_CROP_ASPECT_RATIO:function(){var e=U(t.options.cropAspectRatio)?Rt(t.options.cropAspectRatio):t.options.cropAspectRatio,n=Yt(t);return n?n.find(function(t){return t.value===e})?e:n[0].value:e},GET_CROP_RECTANGLE_ASPECT_RATIO:function(){var e=t.crop.rectangle;return e.width/e.height},GET_CROP_FLIP:function(){return t.crop.flip?o({},t.crop.flip):o({},t.instructions.crop.flip)},GET_CROP_ROTATION:function(){return o({},t.crop.rotation)},GET_CROP:function(e,n){var i=n+"",r=kt[e]?kt[e][i]:null;if(r)return r;kt[e]||(kt[e]=[]);var o=Zt(t);return kt[e][i]=o,o}}},Wt=function(t,e){var n=wt(e);return!function(t,e){return lt(t.x)===lt(e.x)&&lt(t.y)===lt(e.y)}(wt(t),n)},Zt=function(t){if(!t.stage||!t.image)return null;var e=t.crop.draft.rectangle||{free:t.crop.rectangle,limited:t.crop.rectangle},n=t.crop.draft.transforms||t.crop.transforms,i=n.origin,r=n.translation,o=n.scale,a=n.interaction,c=t.crop.rotation,u=t.crop.flip,l=!(!t.crop.draft.rectangle&&!t.crop.draft.transforms),f=l||t.instantUpdate,d=Wt(e.limited,t.stage),h=t.crop.isDirty||l,p=t.crop.isRotating,m={crop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.zoom,i=e.rotation,r=e.center,o=e.aspectRatio,a=It(t,o,n),c={x:.5*a.width,y:.5*a.height},u={x:0,y:0,width:a.width,height:a.height,center:c},l=n*Pt(t,At(u,o),i,r);return{width:Math.round(a.width/l),height:Math.round(a.height/l)}}(t.image,Vt(t.image,{rectangle:e.limited,transforms:{origin:i,translation:r,scale:o,rotation:c.main+c.sub},flip:u})),image:function(t,e){var n=function(t){return!1===t.size.width?function(t){return t.options.size?t.options.size.width:null}(t):t.size.width}(t),i=function(t){return!1===t.size.height?function(t){return t.options.size?t.options.size.height:null}(t):t.size.height}(t),r=e.width/e.height;return n&&!i?i=Math.round(n/r):i&&!n&&(n=Math.round(i*r)),{width:n,height:i}}(t,e.limited)},g={x:0,y:0},v=0,y=0;if(f&&a){if(a.translation){var E=a.translation.x-r.x,_=a.translation.y-r.y;g.x=100*Math.sign(E)*Math.log10(1+Math.abs(E)/100),g.y=100*Math.sign(_)*Math.log10(1+Math.abs(_)/100)}if(a.scale){var w=a.scale-o;v=.25*Math.sign(w)*Math.log10(1+Math.abs(w)/.25)}if(a.rotation){var x=a.rotation-(c.main+c.sub);y=.05*Math.sign(x)*Math.log10(1+Math.abs(x)/.05)}}var T={},R=Et(e.free),A=Et(e.limited);return s(R,function(t){var e=R[t]-A[t];T[t]=A[t]+5*Math.sign(e)*Math.log10(1+Math.abs(e)/5)}),{canRecenter:d,canReset:h,isDraft:f,isRotating:p,cropRect:{x:T.left,y:T.top,width:T.right-T.left,height:T.bottom-T.top},origin:i,translation:r,translationBand:g,scale:o,scaleBand:v,rotation:c,rotationBand:y,flip:u,interaction:a,cropStatus:m}},qt=function(t,e){if(1165519206!==t.getUint32(e+=2,!1))return-1;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var i=t.getUint16(e,n);e+=2;for(var r=0;r<i;r++)if(274===t.getUint16(e+12*r,n))return t.getUint16(e+12*r+8,n)},Ht=function(t){return new Promise(function(e,n){var i=new FileReader;i.onload=function(){return e(function(t){var e=new DataView(t);if(65496!=e.getUint16(0,!1))return null;for(var n,i=e.byteLength,r=2;r<i;){if(e.getUint16(r+2,!1)<=8)return-1;if(n=e.getUint16(r,!1),r+=2,65505===n)return qt(e,r);if(65280!=(65280&n))return null;r+=e.getUint16(r,!1)}}(i.result)||-1)},i.readAsArrayBuffer(t.slice(0,262144))})},Ft=1,jt=2,Qt=function(t,e){var n=t.width,i=n*e;i>t.height&&(n=(i=t.height)/e);var r=.5*(t.width-n),o=.5*(t.height-i);return Tt(r,o,n,i)},Kt=function(t,e,n,i){var r=i.x>.5?1-i.x:i.x,o=i.y>.5?1-i.y:i.y,a=2*r*t.width,c=2*o*t.height,u=function(t,e){var n=t.width,i=t.height,r=St(n,e),o=St(i,e),a=xt(t),c=mt(a.tl.x+Math.abs(r.x),a.tl.y-Math.abs(r.y)),u=mt(a.tr.x+Math.abs(o.y),a.tr.y+Math.abs(o.x)),l=mt(a.bl.x-Math.abs(o.y),a.bl.y-Math.abs(o.x));return{width:dt(c,u),height:dt(c,l)}}(e,n);return Math.max(u.width/a,u.height/c)},Jt=function(t,e,n){var i=t.center,r=t.zoom,o=t.aspectRatio,a=wt(e),c={x:a.x-n.width*i.x,y:a.y-n.height*i.y},u=2*Math.PI+t.rotation%(2*Math.PI),l=Kt(n,Qt(e,o||n.height/n.width),u,i);return{origin:{x:i.x*n.width,y:i.y*n.height},translation:c,scale:r*l,rotation:t.rotation}},$t=function(t){return{origin:o({},t.origin),translation:o({},t.translation),rotation:t.rotation,scale:t.scale}},te=function(t,e,n,i){var r=n.translation,a=n.scale,c=n.rotation,u=n.origin,l={origin:o({},u),translation:o({},r),scale:a,rotation:2*Math.PI+c%(2*Math.PI)},s=t.height/t.width,f={x:u.x+r.x,y:u.y+r.y},d=Gt(e,l.rotation),h=pt(d.tl,-l.rotation,f),p=pt(d.tr,-l.rotation,f),m=pt(d.br,-l.rotation,f),g=pt(d.bl,-l.rotation,f),v={x:Math.min(h.x,p.x,m.x,g.x),y:Math.min(h.y,p.y,m.y,g.y),width:Math.max(h.x,p.x,m.x,g.x)-Math.min(h.x,p.x,m.x,g.x),height:Math.max(h.y,p.y,m.y,g.y)-Math.min(h.y,p.y,m.y,g.y)},y=Tt(v.x,v.y,v.width,v.height),E=wt(y),_=Et(y),w=Lt(t,n),x=wt(w),T={x:w.x,y:w.y},R={x:x.x,y:x.y},A=E.x,I=E.y,C={x:T.x,y:T.y,width:w.width,height:w.height};if(!function(t,e){var n=Et(t),i=Et(e);return n.left>=i.left&&n.top>=i.top&&n.bottom<=i.bottom&&n.right<=i.right}(y,w))if("moving"===i){C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width);var M=Lt(t,o({},n,{scale:l.scale})),O=wt(M);R.x=O.x,R.y=O.y,T.x=M.x,T.y=M.y,C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width);var b={x:C.x-T.x,y:C.y-T.y},P={x:b.x*Math.cos(l.rotation)-b.y*Math.sin(l.rotation),y:b.x*Math.sin(l.rotation)+b.y*Math.cos(l.rotation)};l.translation.x+=P.x,l.translation.y+=P.y}else if("resizing"===i){w.width<y.width&&(C.width=y.width,C.height=C.width*s,C.height<y.height&&(C.height=y.height,C.width=C.height/s)),w.height<y.height&&(C.height=y.height,C.width=C.height/s,C.width<y.width&&(C.width=y.width,C.height=C.width*s)),C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width),l.scale=Kt(t,e,l.rotation,{x:(A-C.x)/C.width,y:(I-C.y)/C.height});var L=Lt(t,o({},n,{scale:l.scale})),S=wt(L);R.x=S.x,R.y=S.y,T.x=L.x,T.y=L.y,C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>y.y?C.y=y.y:C.y+C.height<_.bottom&&(C.y=_.bottom-C.height),C.x>y.x?C.x=y.x:C.x+C.width<_.right&&(C.x=_.right-C.width);var G={x:C.x-T.x,y:C.y-T.y},D={x:G.x*Math.cos(l.rotation)-G.y*Math.sin(l.rotation),y:G.x*Math.sin(l.rotation)+G.y*Math.cos(l.rotation)};l.translation.x+=D.x,l.translation.y+=D.y}else if("rotating"===i){var U=!1;if(C.y>y.y){var V=C.y-y.y;C.y=y.y,C.height+=2*V,U=!0}if(C.y+C.height<_.bottom){var k=_.bottom-(C.y+C.height);C.y=_.bottom-C.height,C.height+=2*k,U=!0}if(C.x>y.x){var N=C.x-y.x;C.x=y.x,C.width+=2*N,U=!0}if(C.x+C.width<_.right){var z=_.right-(C.x+C.width);C.x=_.right-C.width,C.width+=2*z,U=!0}U&&(l.scale=Kt(t,e,l.rotation,{x:(A-w.x)/w.width,y:(I-w.y)/w.height}))}return o({},l,{rotation:n.rotation})},ee={n:function(t){return{x:t.x+.5*t.width,y:t.y}},e:function(t){return{x:t.x+t.width,y:t.y+.5*t.height}},s:function(t){return{x:t.x+.5*t.width,y:t.y+t.height}},w:function(t){return{x:t.x,y:t.y+.5*t.height}}},ne=function(t,e){return ee[t](e)},ie=function(t,e,n){var i=n.origin,r=n.translation,a=(n.scale,2*Math.PI+n.rotation%(2*Math.PI)),c=Lt(t,n),u={x:i.x+r.x,y:i.y+r.y},l=Gt(e,a),s=pt(l.tl,-a,u),f=pt(l.tr,-a,u),d=pt(l.br,-a,u),h={x:Math.min(s.x,f.x,d.x),y:Math.min(s.y,f.y,d.y),width:Math.max(s.x,f.x,d.x)-Math.min(s.x,f.x,d.x),height:Math.max(s.y,f.y,d.y)-Math.min(s.y,f.y,d.y)},p=Tt(h.x,h.y,h.width,h.height),m=Et(p),g=Et(c),v=c;if(m.top<g.top||m.right>g.right||m.bottom>g.bottom||m.left<g.left){var y=o({},g);if(m.top<=y.top){var E=y.bottom-y.top,_=y.right-y.left,w=Math.max(1,p.height/E),x=E*w,T=_*w-_;y.bottom=m.top+x,y.top=m.top,y.left-=.5*T,y.right+=.5*T}if(m.bottom>=y.bottom){var R=y.bottom-y.top,A=y.right-y.left,I=Math.max(1,p.height/R),C=R*I,M=A*I-A;y.bottom=m.bottom,y.top=m.bottom-C,y.left-=.5*M,y.right+=.5*M}if(m.left<=y.left){var O=y.bottom-y.top,b=y.right-y.left,P=Math.max(1,p.width/b),L=b*P,S=O*P-O;y.right=m.left+L,y.left=m.left,y.top-=.5*S,y.bottom+=.5*S}if(m.right>=y.right){var G=y.bottom-y.top,D=y.right-y.left,U=Math.max(1,p.width/D),V=D*U,k=G*U-G;y.right=m.right,y.left=m.right-V,y.top-=.5*k,y.bottom+=.5*k}v=Tt(y.left,y.top,y.right-y.left,y.bottom-y.top)}var N=xt(v),z=wt(v),B=pt(N.tl,a,u),Y=pt(N.br,a,u),X=B.x+.5*(Y.x-B.x),W=B.y+.5*(Y.y-B.y),Z=gt(v,{x:X-z.x,y:W-z.y}),q=gt(p,{x:X-z.x,y:W-z.y}),H=wt(q),F={x:Z.x,y:Z.y},j=Z.width,Q=Z.height,K=(H.x-F.x)/j,J=(H.y-F.y)/Q,$=j/t.width,tt={x:K*t.width,y:J*t.height},et=1-$,nt=tt.x*et,it=tt.y*et,rt={x:F.x+j*K,y:F.y+Q*J},ot=pt(F,a,{x:F.x+.5*j,y:F.y+.5*Q}),at=pt(F,a,rt),ct=ot.x-at.x,ut=ot.y-at.y;return{origin:tt,translation:{x:F.x-nt+ct,y:F.y-it+ut},scale:$,rotation:n.rotation}},re={nw:function(t){return{x:t.x,y:t.y}},ne:function(t){return{x:t.x+t.width,y:t.y}},se:function(t){return{x:t.x+t.width,y:t.y+t.height}},sw:function(t){return{x:t.x,y:t.y+t.height}}},oe=function(t,e){return re[t](e)},ae=Math.PI/2,ce=Math.PI/4,ue=function(t){var e=lt(ce),n=lt(ae),i=t/n,r=Math.floor(i)*n,o=t-r;return o>e&&(o-=n,r+=n),{main:r,sub:o}},le=function(t,e){var n={width:t.width,height:t.height};if(t.width>e.width||t.height>e.height){var i=t.height/t.width,r=e.width/t.width,o=e.height/t.height;r<o?(n.width=t.width*r,n.height=n.width*i):(n.height=t.height*o,n.width=n.height/i)}return n},se={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},fe=function(t){return t&&(t.horizontal||t.vertical)},de=function(t,e,n){if(!e&&!fe(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var i=document.createElement("canvas"),r=t.naturalWidth,o=t.naturalHeight,a=e>=5&&e<=8;a?(i.width=o,i.height=r):(i.width=r,i.height=o);var c=i.getContext("2d");if(e&&c.transform.apply(c,function(t,e,n){return-1===n&&(n=1),se[n](t,e)}(r,o,e)),fe(n)){var u=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(u[0]=-1,u[4]=r),(!a&&n.vertical||a&&n.horizontal)&&(u[3]=-1,u[5]=o),c.transform.apply(c,u)}return c.drawImage(t,0,0,r,o),i};rt()&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(i),r=n.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:e||"image/png"}))})}}));var he=function(){var t={resize:function(t,e){var n=e.mode,i=e.upscale,r=e.width,o=e.height;if(!r&&!o)return t;if(null===r?r=o:null===o&&(o=r),"force"!==n){var a=r/t.width,c=o/t.height,u=1;if("cover"===n?u=Math.max(a,c):"contain"===n&&(u=Math.min(a,c)),u>1&&!1===i)return t;r=t.width*u,o=t.height*u}for(var l=t.width,s=t.height,f=Math.round(r),d=Math.round(o),h=t.data,p=new Uint8ClampedArray(f*d*4),m=l/f,g=s/d,v=Math.ceil(.5*m),y=Math.ceil(.5*g),E=0;E<d;E++)for(var _=0;_<f;_++){for(var w=4*(_+E*f),x=0,T=0,R=0,A=0,I=0,C=0,M=0,O=(E+.5)*g,b=Math.floor(E*g);b<(E+1)*g;b++)for(var P=Math.abs(O-(b+.5))/y,L=(_+.5)*m,S=P*P,G=Math.floor(_*m);G<(_+1)*m;G++){var D=Math.abs(L-(G+.5))/v,U=Math.sqrt(S+D*D);if(U>=-1&&U<=1&&(x=2*U*U*U-3*U*U+1)>0){var V=h[3+(D=4*(G+b*l))];M+=x*V,R+=x,V<255&&(x=x*V/250),A+=x*h[D],I+=x*h[D+1],C+=x*h[D+2],T+=x}}p[w]=A/T,p[w+1]=I/T,p[w+2]=C/T,p[w+3]=M/R}return{data:p,width:f,height:d}}};self.onmessage=function(e){!function(e,n){n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(e.transforms,e.imageData))}(e.data.message,function(t){self.postMessage({id:e.data.id,message:t},[t.data.buffer])})}},pe=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(e+t).slice(-e.length)},me=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return"".concat(t.getFullYear(),"-").concat(pe(t.getMonth()+1,"00"),"-").concat(pe(t.getDate(),"00"),"_").concat(pe(t.getHours(),"00"),"-").concat(pe(t.getMinutes(),"00"),"-").concat(pe(t.getSeconds(),"00"))},ge=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),i=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var r=F();i.onmessage=function(t){t.data.id===r&&e(t.data.message)},i.postMessage({id:r,message:t},n)},terminate:function(){i.terminate(),URL.revokeObjectURL(n)}}},ve=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var i=new n;return i.append(t),i.getBlob(e)}return new Blob([t],{type:e})},ye=function(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=function(t){n(t)},i.src=t})},Ee=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var i=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,i);var r=t.getUint16(e,i);e+=2;for(var o=0;o<r;o++)if(274===t.getUint16(e+12*o,i))return t.setUint16(e+12*o+8,1,i),!0;return!1}},_e=function(t){return new Promise(function(e,n){var i=new FileReader;i.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,i,r=2,o=!1;r<e.byteLength&&(n=e.getUint16(r,!1),i=e.getUint16(r+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(o||(o=Ee(e,r)),!(r+i>e.byteLength));)r+=i;return t.slice(0,r)}(i.result)||null)},i.readAsArrayBuffer(t.slice(0,262144))})},we=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,r){var o=n.stripImageHead,a=n.beforeCreateBlob;if(!function(t){return/^image/.test(t.type)}(t))return r();var c=e.output.quality,u=null===c?null:c/100,l=e.output.type,s=e.crop,f=e.size,d=[];(f.width||f.height)&&d.push({type:"resize",data:f});var h=function(e){var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r="string"==typeof n?t.slice(0,t.size,n):t.slice(0,t.size,t.type);return r.lastModifiedDate=new Date,U(e)||(e=me()),e&&null===i&&function(t){return t.split(".").pop()}(e)?r.name=e:(i=i||function(t){if("string"!=typeof t)return"";var e=t.split("/").pop();return/svg/.test(e)?"svg":/zip|compressed/.test(e)?"zip":/plain/.test(e)?"txt":/msword/.test(e)?"doc":/[a-z]+/.test(e)?"jpeg"===e?"jpg":e:""}(r.type),r.name=e+(i?"."+i:"")),r}(e,function(t,e){var n=function(t){return t.substr(0,t.lastIndexOf("."))||t}(t),i="image/jpeg"===e?"jpg":e.split("/")[1];return"".concat(n,".").concat(i)}(t.name,function(t){return"image/jpeg"===t||"image/png"===t?t:"image/jpeg"}(e.type)));i(n)},p=function(e,n){return function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(i){var r=document.createElement("canvas");r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0);var o=n?n(r):r;Promise.resolve(o).then(function(t){t.toBlob(i,e.type,e.quality)})})}(e,n,a).then(function(e){if(o)return h(e);_e(t).then(function(t){null!==t&&(e=new Blob([t,e.slice(20)],{type:e.type})),h(e)})}).catch(function(t){r(t)})};if(/svg/.test(t.type)&&null===l)(function(t,e){return new Promise(function(n,i){var r=new FileReader;r.onloadend=function(){var i=r.result,o=document.createElement("div");o.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",o.innerHTML=i;var a=o.querySelector("svg");document.body.appendChild(o);var c=a.getBBox();o.parentNode.removeChild(o);var u=o.querySelector("title"),l=a.getAttribute("viewBox")||"",s=a.getAttribute("width")||"",f=a.getAttribute("height")||"",d=parseFloat(s)||null,h=parseFloat(f)||null,p=(s.match(/[a-z]+/)||[])[0]||"",m=(f.match(/[a-z]+/)||[])[0]||"",g=l.split(" ").map(parseFloat),v=g.length?{x:g[0],y:g[1],width:g[2],height:g[3]}:c,y=null!=d?d:v.width,E=null!=h?h:v.height;a.style.overflow="visible",a.setAttribute("width",y),a.setAttribute("height",E);var _=e.aspectRatio||E/y,w=y,x=w*_,T=Pt({width:y,height:E},At({width:w,height:x},_),e.rotation,e.center),R=e.zoom*T,A=e.rotation*(180/Math.PI),I={x:.5*w,y:.5*x},C={x:I.x-y*e.center.x,y:I.y-E*e.center.y},M=["rotate(".concat(A," ").concat(I.x," ").concat(I.y,")"),"translate(".concat(I.x," ").concat(I.y,")"),"scale(".concat(R,")"),"translate(".concat(-I.x," ").concat(-I.y,")"),"translate(".concat(C.x," ").concat(C.y,")")],O=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-y:0," ").concat(e.flip.vertical?-E:0,")")],b='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(w).concat(p,'" height="').concat(x).concat(m,'" \nviewBox="0 0 ').concat(w," ").concat(x,'" \npreserveAspectRatio="xMinYMin"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generator: FilePond Image Transform Plugin - https://pqina.nl/filepond --\x3e\n<title>').concat(u?u.textContent:t.name,'</title>\n<desc>Cropped with FilePond.</desc>\n<g transform="').concat(M.join(" "),'">\n<g transform="').concat(O.join(" "),'">\n').concat(a.outerHTML,"\n</g>\n</g>\n</svg>");n(b)},r.readAsText(t)})})(t,s).then(function(e){i(function(t,e){var n=t.slice(0,t.size,t.type);return n.lastModifiedDate=t.lastModifiedDate,n.name=e,n}(ve(e,"image/svg+xml"),t.name))});else{var m=URL.createObjectURL(t);ye(m).then(function(n){URL.revokeObjectURL(m);var i=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.zoom||1,r=de(t,e,n.flip),o={width:r.width,height:r.height},a=document.createElement("canvas"),c=n.aspectRatio||o.height/o.width,u=It(o,c,i),l={x:.5*u.width,y:.5*u.height},s={x:0,y:0,width:u.width,height:u.height,center:l},f=i*Pt(o,At(s,c),n.rotation,n.center);a.width=Math.round(u.width/f),a.height=Math.round(u.height/f),l.x/=f,l.y/=f;var d=l.x-o.width*(n.center?n.center.x:.5),h=l.y-o.height*(n.center?n.center.y:.5),p=a.getContext("2d");return p.translate(l.x,l.y),p.rotate(n.rotation||0),p.drawImage(r,d-l.x,h-l.y,o.width,o.height),p.getImageData(0,0,a.width,a.height)}(n,e.image.orientation,s);if(d.length){var r=ge(he);r.post({transforms:d,imageData:i},function(e){p(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(e),{quality:u,type:l||t.type}),r.terminate()},[i.data.buffer])}else p(i,{quality:u,type:l||t.type})})}})},xe=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t("GET_CROP_ASPECT_RATIO"),r={center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null};n?Object.assign(r,n):e.options.crop?Object.assign(r,e.options.crop):r.aspectRatio=i;var o=e.size,a=o.width,c=o.height;if(a&&c)r.aspectRatio=a/c;else if(e.instructions.size){var u=e.instructions.size,l=u.width,s=u.height;r.aspectRatio=l/s}return r},Te=Math.PI/2,Re=function(t){var e={upscale:t("GET_OUTPUT_UPSCALE"),mode:t("GET_OUTPUT_FIT"),width:t("GET_OUTPUT_WIDTH"),height:t("GET_OUTPUT_HEIGHT")},n=t("GET_SIZE_INPUT");if(t("ALLOW_MANUAL_RESIZE")&&(n.width||n.height)){var i=n.width,r=n.height,o=t("GET_CROP_RECTANGLE_ASPECT_RATIO");i&&!r?r=i/o:r&&!i&&(i=r*o),e.width=i,e.height=r,e.upscale=!0,e.mode="force"}return e},Ae=function(t){t.crop.draft.rotateMinScale=null},Ie=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function(t){t.crop.draft.rotateMinScale||(t.crop.draft.rotateMinScale=t.crop.transforms.scale)}(t);var r=o({},t.crop.transforms,{scale:t.crop.draft.rotateMinScale});t.crop.draft.transforms=Ue(t.image,t.crop.rectangle,r,e.main+e.sub,n,t.crop.draft.transforms?t.crop.draft.transforms.rotation:t.crop.rotation.main+t.crop.rotation.sub,i),t.crop.rotation=ue(t.crop.draft.transforms.rotation)},Ce=function(t,e){if(null!==t.stage){Le(t),t.crop.rectangle=Qt(t.stage,t.instructions.crop.aspectRatio||t.image.aspectRatio),t.crop.draft.rectangle=null,t.crop.transforms=Jt(t.instructions.crop,t.stage,t.image),t.crop.draft.transforms=null,t.crop.rotation=ue(t.instructions.crop.rotation),t.crop.flip=o({},t.instructions.crop.flip);var n=e("GET_CROP_ASPECT_RATIO_OPTIONS")||[],i=n.map(function(t){return t.value}).find(function(e){return e===t.instructions.crop.aspectRatio}),r=n.find(function(t){return null===t.value});i?t.crop.aspectRatio=i:r&&n.length?t.crop.aspectRatio=null:t.crop.aspectRatio=e("GET_CROP_ASPECT_RATIO"),t.crop.isDirty=!1,t.size.width=!!t.instructions.size&&t.instructions.size.width,t.size.height=!!t.instructions.size&&t.instructions.size.height,t.size.aspectRatioLocked=!0,t.size.aspectRatioPrevious=!1,Ae(t)}},Me=function(t){if(t.stage){Le(t);var e=t.crop.draft.transforms||t.crop.transforms,n=Dt(t.image,t.crop.rectangle,e);t.crop.aspectRatio&&(n.aspectRatio=t.crop.aspectRatio),t.crop.transforms=Jt(n,t.stage,t.image),t.crop.draft.transforms=null;var i=t.crop.aspectRatio||t.crop.rectangle.height/t.crop.rectangle.width;t.crop.rectangle=Qt(t.stage,i),t.crop.draft.rectangle=null,Ae(t)}},Oe=function(t){t.crop.draft.rectangle=null,t.crop.transforms=t.crop.draft.transforms||t.crop.transforms,t.crop.transforms.interaction=null,t.crop.draft.transforms=null,t.crop.transforms=o({},t.crop.transforms,function(t,e,n){var i=n.origin,r=n.translation,o=n.scale,a=2*Math.PI+n.rotation%(2*Math.PI),c={x:i.x+r.x,y:i.y+r.y},u=Gt(e,a),l=pt(u.tl,-a,c),s=pt(u.tr,-a,c),f=pt(u.br,-a,c),d=pt(u.bl,-a,c),h=Tt(Math.min(l.x,s.x,f.x,d.x),Math.min(l.y,s.y,f.y,d.y),Math.max(l.x,s.x,f.x,d.x)-Math.min(l.x,s.x,f.x,d.x),Math.max(l.y,s.y,f.y,d.y)-Math.min(l.y,s.y,f.y,d.y)),p=Tt(h.x,h.y,h.width,h.height),m=Lt(t,n),g=xt(m),v=wt(m),y=pt(g.tl,a,c),E=pt(g.br,a,c),_=y.x+.5*(E.x-y.x),w=y.y+.5*(E.y-y.y),x=gt(m,{x:_-v.x,y:w-v.y}),T=gt(p,{x:_-v.x,y:w-v.y}),R=wt(T),A={x:x.x,y:x.y},I=x.width,C=x.height,M=(R.x-A.x)/I,O=(R.y-A.y)/C,b={x:M*t.width,y:O*t.height},P=1-o,L=b.x*P,S=b.y*P,G={x:A.x+I*M,y:A.y+C*O},D=pt(A,a,{x:A.x+.5*I,y:A.y+.5*C}),U=pt(A,a,G),V=D.x-U.x,k=D.y-U.y;return{origin:st(b),translation:st({x:A.x-L+V,y:A.y-S+k})}}(t.image,t.crop.rectangle,t.crop.transforms)),t.crop.isRotating=!1,t.crop.isDirty=!0},be=function(t,e,n){var i=e("GET_CROP_ZOOM_TIMEOUT");i&&(clearTimeout(t.zoomTimeoutId),t.zoomTimeoutId=setTimeout(function(){n("CROP_ZOOM")},i))},Pe=function(t,e,n){Le(t),be(t,e,n)},Le=function(t){clearTimeout(t.zoomTimeoutId)},Se=function(t){t.crop.rectangle=t.crop.draft.rectangle.limited,t.crop.draft.rectangle=null,Oe(t),Ae(t)},Ge=function(t){t.crop.draft.transforms=$t(t.crop.transforms),t.crop.draft.rectangle={limited:yt(t.crop.rectangle),free:yt(t.crop.rectangle)},Le(t)},De=function(t,e){return Math.min(t.width/e.width,t.height/e.height)},Ue=function(t,e,n,i,r,a,c){var u=te(t,e,o({},$t(n),{rotation:i}),"rotating"),l=De(e,r);return lt(u.scale,5)>lt(l,5)?(c&&(a+=2*c),o({},$t(n),{rotation:a,interaction:{rotation:u.rotation}})):(u.scale=Math.min(l,u.scale),u.interaction={rotation:u.rotation},u)},Ve=function(t,e,n,i,r){var a=Math.max(1e-10,i),c=te(t,e,o({},$t(n),{scale:a}),"resizing"),u=De(e,r);return c.scale=Math.min(u,c.scale),c.interaction={scale:a},c},ke=function(t){return!1===t.file},Ne=function(t,e,n){return{AWAIT_IMAGE:function(){n.file||(n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},250))},REQUEST_REMOVE_IMAGE:function(){t("UNLOAD_IMAGE"),n.file=!1,n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},500)},DID_UNLOAD_IMAGE:function(){t("ABORT_IMAGE")},REQUEST_ABORT_IMAGE:function(e){t("UNLOAD_IMAGE"),n.file=!1,n.queuedFile=e},DID_SET_SRC:function(e){e.value!==e.prevValue&&(clearTimeout(n.noImageTimeout),t("REQUEST_LOAD_IMAGE",{source:e.value}))},ABORT_IMAGE:function(){if(n.file=null,n.queuedFile){var e=n.queuedFile;n.queuedFile=null,t("REQUEST_LOAD_IMAGE",e)}},REQUEST_LOAD_IMAGE:function(e){var i=e.source,r=e.success,o=void 0===r?function(){}:r,a=e.failure,c=void 0===a?function(t){}:a,u=e.options,l=e.resolveOnConfirm,s=void 0!==l&&l;if(clearTimeout(n.noImageTimeout),!i)return c();null===n.file?(Z(n),n.file={uid:F()},t("DID_REQUEST_LOAD_IMAGE"),function(t){return new Promise(function(e,n){if(U(t))fetch(t).then(function(t){return t.blob()}).then(function(t){return e(t)});else if(t instanceof Blob)e(t);else{if("IMG"===t.nodeName){var i=function(t){var n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight,n.getContext("2d").drawImage(t,0,0),n.toBlob(e)};return t.complete?void i(t):void(t.onload=function(){i(t)})}"CANVAS"!==t.nodeName?n(t):t.toBlob(e)}})}(i).then(function(e){if(ke(n))return t("ABORT_IMAGE");e.name||(e.name=me()),n.file.orientation=-1,n.file.data=e,t("LOAD_IMAGE",{success:o,failure:c,options:u,resolveOnConfirm:s},!0),t("KICK")}).catch(function(e){if(ke(n))return t("ABORT_IMAGE");c(e)})):t("REQUEST_ABORT_IMAGE",{source:i,success:o,failure:c,options:u,resolveOnConfirm:s})},LOAD_IMAGE:function(i){var r=i.success,a=i.failure,c=i.options,u=void 0===c?{}:c,l=i.resolveOnConfirm;if(ke(n))return t("ABORT_IMAGE");var s=n.file.data;Promise.all([function(t){return new Promise(function(e,n){var i=new Image;i.src=URL.createObjectURL(t),i.onerror=function(t){clearInterval(r),n(t)};var r=setInterval(function(){i.naturalWidth&&i.naturalHeight&&(clearInterval(r),URL.revokeObjectURL(i.src),e({width:i.naturalWidth,height:i.naturalHeight}))},1)})}(s),Ht(s)]).then(function(i){if(ke(n))return t("ABORT_IMAGE");var c=i[0],s=i[1];n.file.orientation=s;var f=c.width,d=c.height;s>=5&&s<=8?(c.width=d,c.height=f):(c.width=f,c.height=d);var h=e("GET_MIN_IMAGE_SIZE");if(c.width<h.width||c.height<h.height)return t("DID_LOAD_IMAGE_ERROR"),Z(n),void a();var p=le(c,{width:e("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e("GET_MAX_IMAGE_PREVIEW_HEIGHT")});n.image={x:0,y:0,width:p.width,height:p.height,naturalWidth:c.width,naturalHeight:c.height,aspectRatio:c.height/c.width},e("ALLOW_MANUAL_RESIZE")&&u.size&&(n.instructions.size={width:u.size.width,height:u.size.height}),n.instructions.crop=xe(e,n,u.crop?o({},u.crop):null),t("DID_LOAD_IMAGE"),n.filePromise={resolveOnConfirm:l,success:r,failure:a}}).catch(function(e){if(ke(n))return t("ABORT_IMAGE");t("DID_LOAD_IMAGE_ERROR"),Z(n),a()})},CHANGE_VIEW:function(e){var i=e.id;n.activeView=i,t("SHOW_VIEW",{id:i})},UPDATE_ROOT_RECT:function(t){var e=t.rect;n.rootRect=e},DID_RESIZE_STAGE:function(t){var i=t.size,r=t.offset,o=t.animate,a=null===n.stage;if(n.stage=Tt(0,0,i.width,i.height),n.stageOffset=mt(r.x,r.y),a){if(Ce(n,e),!n.filePromise.resolveOnConfirm){var c=Ut(n.image,n.crop),u=Re(e);n.filePromise.success({crop:c,image:{orientation:n.file.orientation},size:u,output:{type:e("GET_OUTPUT_TYPE"),quality:e("GET_OUTPUT_QUALITY")}})}}else n.instantUpdate=!o,Me(n),setTimeout(function(){n.instantUpdate=!1},16)},RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK:function(t){var e=t.value;n.size.aspectRatioLocked=e},RESIZE_SET_OUTPUT_SIZE:function(e){var i=e.width,r=e.height;if(i=i||null,r=r||null,n.size.width=i,n.size.height=r,i&&r){var o=r/i;if(o===n.crop.aspectRatio)return;!1===n.size.aspectRatioPrevious&&(n.size.aspectRatioPrevious=n.crop.aspectRatio),t("CROP_SET_ASPECT_RATIO",{value:o})}else!1!==n.size.aspectRatioPrevious&&(t("CROP_SET_ASPECT_RATIO",{value:n.size.aspectRatioPrevious}),n.size.aspectRatioPrevious=!1)},CROP_SET_ASPECT_RATIO:function(t){var e=t.value;if(Le(n),n.crop.aspectRatio=e,e&&Me(n),n.crop.isDirty=!0,n.size.width&&n.size.height)if(e){var i=n.size.height/n.size.width;i!==e&&(i<e?n.size.height=n.size.width/e:n.size.width=n.size.height*e)}else n.size.height=null},CROP_ZOOM:function(){n.stage&&(Le(n),Me(n))},CROP_RECT_CORNER_DRAG_RELEASE:function(){return Se(n)||be(n,e,t)},CROP_RECT_EDGE_DRAG_RELEASE:function(){return Se(n)||be(n,e,t)},CROP_IMAGE_RESIZE_GRAB:function(){return Ge(n)||Le(n)},CROP_IMAGE_ROTATE_GRAB:function(){Ge(n),Le(n),n.crop.isRotating=!0},CROP_RECT_EDGE_DRAG_GRAB:function(){return Ge(n)||Le(n)},CROP_RECT_CORNER_DRAG_GRAB:function(){return Ge(n)||Le(n)},CROP_RECT_EDGE_DRAG:function(t){var i=t.offset,r=t.origin,o=t.anchor,a=n.image,c=n.stage,u=/n|s/.test(r)?jt:Ft,l=ne(r,n.crop.rectangle),s=ne(o,n.crop.rectangle),f=ht({x:l.x+(u===Ft?i.x:0),y:l.y+(u===jt?i.y:0)},c),d=e("GET_MIN_CROP_SIZE"),h=e("GET_MAX_CROP_SIZE"),p=De(n.crop.rectangle,e("GET_MIN_IMAGE_SIZE"))/n.crop.transforms.scale;d.width=lt(d.width),d.height=lt(d.height),h.width=lt(h.width*p),h.height=lt(h.height*p);var m={x:Math.sign(l.x-s.x),y:Math.sign(l.y-s.y)};n.crop.draft.rectangle=function(t,e,n,i,r,o,a,c,u){var l=o.left,s=o.right,f=o.top,d=o.bottom,h=s-l,p=d-f,m=r.left,g=r.right,v=r.top,y=r.bottom;if(n===jt){if(v=t.y>0?i.y:Math.min(i.y,Math.max(e.y,f)),y=t.y>0?Math.max(i.y,Math.min(e.y,d)):i.y,a){var E=(y-v)/a;m=i.x-.5*E,g=i.x+.5*E}}else if(m=t.x>0?i.x:Math.min(i.x,Math.max(e.x,l)),g=t.x>0?Math.max(i.x,Math.min(e.x,s)):i.x,a){var _=(g-m)*a;v=i.y-.5*_,y=i.y+.5*_}var w,x,T,R,A=c.width,I=c.height;if(n===jt?(w=i.x-.5*A,x=i.x+.5*A,t.y<0?(T=i.y-I,R=i.y):t.y>0&&(T=i.y,R=i.y+I)):(T=i.y-.5*I,R=i.y+.5*I,t.x<0?(w=i.x-A,x=i.x):t.x>0&&(w=i.x,x=i.x+A)),a)if(n===jt){var C=Math.min((y-v)/a,h),M=C*a;m<l&&(g=(m=l)+C),g>s&&(m=(g=s)-C),i.x=m+.5*C,t.y<0?v=i.y-M:t.y>0&&(y=i.y+M)}else{var O=Math.min((g-m)*a,p),b=O/a;v<f&&(y=(v=f)+O),y>d&&(v=(y=d)-O),i.y=v+.5*O,t.x<0?m=i.x-b:t.x>0&&(g=i.x+b)}var P=_t({top:v,right:g,bottom:y,left:m}),L=function(){var e=A*a;n===Ft?(v=i.y-.5*e,y=i.y+.5*e):t.y<0?(y=i.y,v=y-e):t.y>0&&(v=i.y,y=v+e)},S=function(){var e=I/a;n===jt?(m=i.x-.5*e,g=i.x+.5*e):t.x<0?(g=i.x,m=g-e):t.x>0&&(m=i.x,g=m+e)};if(g<x&&(g=x,m=x-A,a&&L()),m>w&&(m=w,g=w+A,a&&L()),v>T&&(v=T,y=T+I,a&&S()),y<R&&(y=R,v=R-I,a&&S()),g-m>u.width&&(t.x<0?m=i.x-u.width:g=i.x+u.width),y-v>u.height&&(t.y<0?v=i.y-u.height:y=i.y+u.height),g-m==0&&(t.x>0?g=i.x+2:m=i.x-2),y-v==0&&(t.y>0?y=i.y+2:v=i.y-2),Math.round(m)<l||Math.round(g)>s||Math.round(v)<f||Math.round(y)>d){var G=d-f,D=s-l;if(m<l){m=l;var U=Math.min(g-m,D);g=m+U}if(g>s){g=s;var V=Math.min(g-m,D);m=g-V}if(v<f){v=f;var k=Math.min(y-v,G);y=v+k}if(y>d){y=d;var N=Math.min(y-v,G);v=y-N}P=_t({top:v,right:g,bottom:y,left:m})}return{free:P,limited:_t({top:v,right:g,bottom:y,left:m})}}(m,f,u,s,Et(n.crop.rectangle),Et(c),n.crop.aspectRatio,d,h),n.crop.draft.transforms=ie(a,n.crop.draft.rectangle.limited,n.crop.transforms)},CROP_RECT_CORNER_DRAG:function(t){var i=t.offset,r=t.origin,o=t.anchor,a=n.image,c=n.stage,u=oe(r,n.crop.rectangle),l=oe(o,n.crop.rectangle),s={x:u.x+i.x,y:u.y+i.y},f=e("GET_MIN_CROP_SIZE"),d=e("GET_MAX_CROP_SIZE"),h=De(n.crop.rectangle,e("GET_MIN_IMAGE_SIZE"))/n.crop.transforms.scale;f.width=lt(f.width),f.height=lt(f.height),d.width=lt(d.width*h),d.height=lt(d.height*h);var p={x:Math.sign(u.x-l.x),y:Math.sign(u.y-l.y)};n.crop.draft.rectangle=function(t,e,n,i,r,o,a){var c=Et(i),u=c.left,l=c.right,s=c.top,f=c.bottom,d=ht({x:e.x,y:e.y},i),h=t.x>0?n.x:Math.min(d.x,n.x),p=t.x>0?Math.max(n.x,d.x):n.x,m=t.y>0?n.y:Math.min(d.y,n.y),g=t.y>0?Math.max(n.y,d.y):n.y;if(r){var v=d.x-n.x;t.x>0?p=Math.max(n.x,n.x+t.x*v):h=Math.min(n.x,n.x-t.x*v),t.y>0?g=Math.max(n.y,n.y+t.x*v*r):m=Math.min(n.y,n.y-t.x*v*r)}var y=_t({top:m,right:p,bottom:g,left:h});if(_t({top:m,right:p,bottom:g,left:h}),o.width&&o.height&&(p-h<o.width&&(t.x>0?p=n.x+o.width:h=n.x-o.width),g-m<o.height&&(t.y>0?g=n.y+o.height:m=n.y-o.height),p-h>a.width&&(t.x<0?h=n.x-a.width:p=n.x+a.width),g-m>a.height&&(t.y<0?m=n.y-a.height:g=n.y+a.height)),p-h==0&&(t.x>0?p=n.x+2:h=n.x-2),g-m==0&&(t.y>0?g=n.y+2:m=n.y-2),Math.round(h)<u||Math.round(p)>l||Math.round(m)<s||Math.round(g)>f){var E=f-s,_=l-u;if(h<u){h=u;var w=Math.min(p-h,_);p=h+w,r&&(t.y>0&&(g=n.y+w*r),t.y<0&&(m=n.y-w*r))}if(p>l){p=l;var x=Math.min(p-h,_);h=p-x,r&&(t.y>0&&(g=n.y+x*r),t.y<0&&(m=n.y-x*r))}if(m<s){m=s;var T=Math.min(g-m,E);g=m+T,r&&(t.x>0&&(p=n.x+T/r),t.x<0&&(h=n.x-T/r))}if(g>f){g=f;var R=Math.min(g-m,E);m=g-R,r&&(t.x>0&&(p=n.x+R/r),t.x<0&&(h=n.x-R/r))}y=_t({top:m,right:p,bottom:g,left:h})}return{free:y,limited:_t({top:m,right:p,bottom:g,left:h})}}(p,s,l,c,n.crop.aspectRatio,f,d),n.crop.draft.transforms=ie(a,n.crop.draft.rectangle.limited,n.crop.transforms)},CROP_IMAGE_DRAG_GRAB:function(){return Ge(n)||Le(n)},CROP_IMAGE_DRAG_RELEASE:function(){Oe(n),Ae(n),be(n,e,t)},CROP_IMAGE_RESIZE_RELEASE:function(){Oe(n),Ae(n),be(n,e,t)},CROP_IMAGE_ROTATE_RELEASE:function(){Oe(n),be(n,e,t)},CROP_IMAGE_DRAG:function(t){var e=t.value;Le(n),n.crop.draft.transforms=function(t,e,n,i){var r={x:n.translation.x+i.x,y:n.translation.y+i.y},a=te(t,e,o({},$t(n),{translation:r}),"moving");return a.interaction={translation:r},a}(n.image,n.crop.rectangle,n.crop.transforms,e)},CROP_IMAGE_RESIZE:function(t){var i=t.value;Le(n);var r=n.crop.transforms;n.crop.draft.transforms=Ve(n.image,n.crop.rectangle,r,r.scale+r.scale*i,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_RESIZE_MULTIPLY:function(t){var i=t.value;Le(n);var r=n.crop.transforms;n.crop.draft.transforms=Ve(n.image,n.crop.rectangle,r,r.scale*i,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_RESIZE_AMOUNT:function(t){var i=t.value;Le(n);var r=n.crop.transforms;n.crop.draft.transforms=Ve(n.image,n.crop.rectangle,r,(n.crop.draft.transforms?n.crop.draft.transforms.scale:r.scale)+i,e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_ROTATE:function(t){var i=t.value;Le(n),n.crop.isRotating=!0,Ie(n,{main:n.crop.rotation.main,sub:i},e("GET_MIN_PREVIEW_IMAGE_SIZE"))},CROP_IMAGE_ROTATE_ADJUST:function(t){var i=t.value;Le(n),Ie(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+i))},e("GET_MIN_PREVIEW_IMAGE_SIZE")),Oe(n)},CROP_IMAGE_ROTATE_CENTER:function(){Le(n),Ie(n,{main:n.crop.rotation.main,sub:0},e("GET_MIN_PREVIEW_IMAGE_SIZE")),Oe(n)},CROP_IMAGE_ROTATE_LEFT:function(){Pe(n,e,t),Ie(n,{main:n.crop.rotation.main-Te,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE"),-Te),Oe(n)},CROP_IMAGE_ROTATE_RIGHT:function(){Pe(n,e,t),Ie(n,{main:n.crop.rotation.main+Te,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE"),Te),Oe(n)},CROP_IMAGE_FLIP_HORIZONTAL:function(){Pe(n,e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){Pe(n,e,t),n.crop.rotation.main%Math.PI/2==0?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},DID_SET_SIZE:function(e){var n=e.value;n!==e.prevValue&&t("SET_DATA",{size:n})},DID_SET_CROP:function(e){var n=e.value;n!==e.prevValue&&t("SET_DATA",{crop:n})},SET_DATA:function(i){if(e("ALLOW_MANUAL_RESIZE")&&i.size){var r=i.size||{},a=r.width,c=r.height;n.instructions.size=o({},i.size),t("RESIZE_SET_OUTPUT_SIZE",{width:a,height:c})}i.crop&&(n.instructions.crop=xe(e,n,i.crop),t("EDIT_RESET"))},GET_DATA:function(i){var r=i.success,o=i.failure,a=i.file,c=i.data;if(n.file&&n.stage){var u={file:D(a)?a:e("GET_OUTPUT_FILE"),data:D(c)?c:e("GET_OUTPUT_DATA"),success:r,failure:o};t(u.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",u)}},REQUEST_PREPARE_OUTPUT:function(e){var n=e.file,i=e.data,r=e.success,o=e.failure;t("PREPARE_OUTPUT",{file:n,data:i,success:r,failure:o},!0),t("DID_REQUEST_PREPARE_OUTPUT")},PREPARE_OUTPUT:function(i){var r=i.file,o=i.data,a=i.success,c=void 0===a?function(){}:a,u=i.failure,l=void 0===u?function(){}:u;if(ke(n))return t("ABORT_IMAGE");(function(t,e,n){return new Promise(function(i,r){var o={data:null,file:null},a=Ut(e.image,e.crop),c=Re(n),u={crop:a,image:{orientation:e.file.orientation},size:c,output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY")}};if(t.data&&(o.data=u),t.file){var l={beforeCreateBlob:n("GET_BEFORE_CREATE_BLOB"),stripImageHead:n("GET_OUTPUT_STRIP_IMAGE_HEAD")};we(e.file.data,u,l).then(function(t){o.file=t,i(o)}).catch(r)}else i(o)})})({file:r,data:o},n,e).then(function(e){if(t("DID_PREPARE_OUTPUT"),ke(n))return t("ABORT_IMAGE");c(e)}).catch(function(e){if(ke(n))return t("ABORT_IMAGE");l(e)})},EDIT_RESET:function(){Le(n),Ce(n,e)},EDIT_CONFIRM:function(){if(n.file&&n.stage){Le(n),t("CROP_ZOOM");var i={file:e("GET_OUTPUT_FILE"),data:e("GET_OUTPUT_DATA"),success:function(e){n.filePromise.resolveOnConfirm&&n.filePromise.success(e),t("DID_CONFIRM",{output:e})}};t(i.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",i)}},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.success(null),t("DID_CANCEL")},EDIT_CLOSE:function(){Le(n)},EDIT_DESTROY:function(){Z(n)},SET_OPTIONS:function(e){var n=e.options;s(n,function(e,n){t("SET_".concat(q(e,"_").toUpperCase()),{value:n})})}}},ze=function(t,e){return O({ignoreRect:!0,name:t,mixins:e,create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})},Be=function(t){t.element.dataset.viewStatus="idle",Ye(t)},Ye=function(t){t.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0,t.markedForRemoval=!0})},Xe=function(t,e){t.element.dataset.viewStatus="busy";var n=We(t,e);Ye(t),t.ref.busyIndicators.push(n),n.markedForRemoval=!1,n.translateY=0,n.opacity=1},We=function(t,e){return t.appendChildView(t.createChildView(ze("status-bubble",{styles:["opacity","translateY"],apis:["markedForRemoval"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}}),{translateY:20,opacity:0,controls:[{view:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return O({ignoreRect:!0,tag:t,create:function(t){t.root.element.textContent=e}})}("p",e)}]}))},Ze=O({name:"edit-status",ignoreRect:!0,create:function(t){var e=t.root;e.ref.busyIndicators=[],e.element.setAttribute("tabindex",-1)},write:b({AWAITING_IMAGE:function(t){var e=t.root;e.rect.element.hidden||Xe(e,e.query("GET_LABEL_STATUS_AWAITING_IMAGE"))},DID_PRESENT_IMAGE:function(t){var e=t.root;Be(e)},DID_LOAD_IMAGE_ERROR:function(t){var e=t.root;Xe(e,e.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"))},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root;Xe(e,e.query("GET_LABEL_STATUS_LOADING_IMAGE"))},DID_REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;Xe(e,e.query("GET_LABEL_STATUS_PROCESSING_IMAGE"))},DID_PREPARE_OUTPUT:function(t){var e=t.root;Be(e)}}),didWriteView:function(t){var e=t.root;e.ref.busyIndicators=e.ref.busyIndicators.filter(function(t){return!t.markedForRemoval||0!==t.opacity||(e.removeChildView(t),!1)})}}),qe={down:"pointerdown",move:"pointermove",up:"pointerup"},He=function(){var t=[],e=function(e){return t.findIndex(function(t){return t.pointerId===e.pointerId})};return{update:function(n){var i=e(n);i<0||(t[i]=n)},multiple:function(){return t.length>1},count:function(){return t.length},active:function(){return t.concat()},push:function(n){e(n)>=0||t.push(n)},pop:function(n){var i=e(n);i<0||t.splice(i,1)}}},Fe=function(t,e,n,i){return t.addEventListener(qe[e],n,i)},je=function(t,e,n){return t.removeEventListener(qe[e],n)},Qe=function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{stopPropagation:!0,cancelOnMultiple:!1},o={x:0,y:0},a={parameters:null,enabled:!0,origin:null,cancel:!1,cancelled:!1,pointers:He()},c=function(t,e){return e.apply(null,[function(t){return{x:t.pageX-o.x,y:t.pageY-o.y}}(t)].concat(a.parameters))},u=function(n){var i=0===a.pointers.count();i&&(a.active=!1,a.cancel=!1,a.cancelled=!1),a.pointers.push(n),Fe(document.documentElement,"up",s),i?(t===n.target||t.contains(n.target))&&n.isPrimary&&(n.preventDefault(),r.stopPropagation&&(n.stopPropagation(),n.stopImmediatePropagation()),a.active=!0,o.x=n.pageX,o.y=n.pageY,Fe(document.documentElement,"move",l),a.parameters=e()||[]):r.cancelOnMultiple&&(a.cancel=!0)},l=function(t){t.isPrimary&&(a.cancelled||(t.preventDefault(),c(t,n),a.cancel&&(a.cancelled=!0,c(t,i))))},s=function t(e){a.pointers.pop(e),0===a.pointers.count()&&(je(document.documentElement,"move",l),je(document.documentElement,"up",t)),a.active&&(a.cancelled||(e.preventDefault(),r.stopPropagation&&e.stopPropagation(),c(e,n),c(e,i)))};return Fe(document.documentElement,"down",u),{enable:function(){a.enabled||Fe(document.documentElement,"down",u),a.enabled=!0},disable:function(){a.enabled&&je(document.documentElement,"down",u),a.enabled=!1},destroy:function(){je(document.documentElement,"up",s),je(document.documentElement,"move",l),je(document.documentElement,"down",u)}}},Ke=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},Je={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},$e=function(t,e,n,i,r){e=Math.round(e),n=Math.round(n);var o=r||document.createElement("canvas"),a=o.getContext("2d");return i>=5&&i<=8?(o.width=n,o.height=e):(o.width=e,o.height=n),a.save(),function(t,e,n,i){-1!==i&&t.transform.apply(t,Je[i](e,n))}(a,e,n,i),a.drawImage(t,0,0,e,n),a.restore(),o},tn=O({name:"image-preview",ignoreRect:!0,ignoreRectUpdate:!0,tag:"canvas",mixins:{styles:["perspective","rotateX","rotateY","rotateZ","scaleX","scaleY"],animations:{rotateX:{type:"spring",stiffness:.25,damping:.25,mass:2.5},rotateY:{type:"spring",stiffness:.25,damping:.25,mass:2.5},scaleX:{type:"spring",stiffness:.25,damping:.75,mass:15},scaleY:{type:"spring",stiffness:.25,damping:.75,mass:15}}},write:b({DID_PRESENT_IMAGE:function(t){var e=t.root;e.scaleX=1,e.scaleY=1}}),create:function(t){var e=t.root;e.rotateZ=1e-5;var n="preview"!==e.query("GET_STYLE_LAYOUT_MODE");e.scaleX=n?1.15:1,e.scaleY=n?1.15:1,e.rotateX=n?1:null,e.rotateY=n?1:null;var i=e.query("GET_FILE"),r=URL.createObjectURL(i.data);!function(){var t=function(t){var n=le(t,{width:e.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")});$e(t,n.width,n.height,i.orientation,e.element),e.dispatch("DID_PRESENT_IMAGE")},n=function(){ye(r).then(t)};if(function(t){return"createImageBitmap"in window&&function(t){return/^image/.test(t.type)&&!/svg/.test(t.type)}(t)}(i.data)){var o=ge(Ke);o.post({file:i.data},function(e){o.terminate(),e?t(e):n()})}else n()}()}}),en={type:"spring",stiffness:.4,damping:.65,mass:7},nn=O({name:"image-container",tag:"div",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["flipHorizontal","flipVertical","scale"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ","opacity"],animations:{opacity:{type:"tween",delay:150,duration:750},scaleX:en,scaleY:en,translateX:en,translateY:en,originX:en,originY:en,rotateZ:{type:"spring",stiffness:.25,damping:.25,mass:2.5}}},create:function(t){var e=t.root;e.ref.image=e.appendChildView(e.createChildView(tn,{rotateX:0,rotateY:0,perspective:2e3})),e.ref.dragger=Qe(e.element,function(){e.dispatch("CROP_IMAGE_DRAG_GRAB")},function(t){e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(){e.dispatch("CROP_IMAGE_DRAG_RELEASE")},{cancelOnMultiple:!0})},destroy:function(t){t.root.ref.dragger.destroy()},write:b({SHOW_VIEW:function(t){var e=t.root;"crop"===t.action.id?(e.element.setAttribute("tabindex",0),e.ref.dragger.enable()):(e.element.removeAttribute("tabindex"),e.ref.dragger.disable())}},function(t){var e=t.root,n=t.props,i=e.ref.image;i.rotateX=n.flipVertical?Math.PI:0,i.rotateY=n.flipHorizontal?Math.PI:0})}),rn=rt()&&1===window.devicePixelRatio?function(t){return Math.round(t)}:function(t){return t},on=function(t,e,n,i,r,o){t||(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null);var a=rn(n),c=rn(i),u=rn(n+r)-a,l=rn(i+o)-c;e.translateX=a,e.translateY=c,e.scaleX=.01*u,e.scaleY=.01*l},an=["top","right","bottom","left"],cn=O({ignoreRect:!0,name:"image-overlay",mixins:{styles:["opacity"],animations:{opacity:"spring"},apis:["rectangle","container","animate"]},create:function(t){var e=t.root;an.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return O({ignoreRect:!0,ignoreRectUpdate:!0,name:"image-overlay-panel-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:en,translateY:en,scaleX:en,scaleY:en}}})}(t)))})},write:function(t){var e=t.root,n=t.props,i=e.ref,r=i.top,o=i.right,a=i.bottom,c=i.left,u=n.rectangle,l=n.container,s=n.animate;if(u){var f=e.rect.element,d=l,h=u.x,p=u.y,m=d.top,g=d.left,v=p+m,y=d.width,E=h+g,_=h+u.width,w=p+u.height,x=d.height-(w+m),T=g+f.width-(h+u.width);on(s,r,-g-2,-m-2,y+4,v+2),on(s,c,-g-2,p-2,E+2,u.height+4),on(s,o,_,p-2,T+2,u.height+4),on(s,a,-g-2,w,y+4,x+2)}}}),un=["top","right","bottom","left"],ln=O({name:"image-outline",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"spring"}},apis:["animate","rectangle","edgeWidth"]},create:function(t){var e=t.root;un.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return O({ignoreRect:!0,ignoreRectUpdate:!0,name:"image-outline-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:en,translateY:en,scaleX:en,scaleY:en}}})}(t)))})},write:function(t){var e=t.root,n=t.props,i=e.ref,r=i.top,o=i.right,a=i.bottom,c=i.left,u=n.animate,l=n.rectangle,s=n.edgeWidth;if(l){var f=l.x,d=l.y,h=l.width,p=l.height,m=2*s;on(u,r,f-s,d-s,h+m,s),on(u,c,f-s,d-s,s,p+m),on(u,o,f+h,d-s,s,p+m),on(u,a,f-s,d+p,h+m,s)}}}),sn=O({name:"image",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},apis:["offsetTop"]},create:function(t){var e=t.root;e.ref.hasTroubleAnimatingTransformOrigin="safari"in window,e.ref.image=e.appendChildView(e.createChildView(nn,{flip:{horizontal:!1,vertical:!1},translateX:null,translateY:null,rotateZ:null,scaleX:null,scaleY:null,opacity:0})),e.ref.overlay=e.appendChildView(e.createChildView(cn,{opacity:0})),e.ref.outline=e.appendChildView(e.createChildView(ln,{opacity:0}))},write:b({DID_PRESENT_IMAGE:function(t){t.root.ref.image.opacity=1}},function(t){var e=t.root,n=t.props,i=t.actions,r=t.timestamp,a=e.ref,c=a.image,u=a.outline,l=a.overlay,s=a.hasTroubleAnimatingTransformOrigin,f=e.query("GET_CROP",n.id,r);if(f){var d=f.isDraft,h=f.cropRect,p=f.cropStatus,m=f.origin,g=f.translation,v=f.translationBand,y=f.scale,E=f.scaleBand,_=f.rotation,w=f.rotationBand,x=f.flip,T=e.query("GET_ROOT"),R=e.query("GET_STAGE"),A=R.x,I=R.y;d&&(c.originX=null,c.originY=null,c.translateX=null,c.translateY=null,c.scaleX=null,c.scaleY=null,c.rotateZ=null),c.perspective=100,s&&i.find(function(t){return"CROP_IMAGE_DRAG_RELEASE"===t.type})&&(imageView.originX=null,imageView.originY=null,imageView.translateX=null,imageView.translateY=null);var C=.8,M=1,O=o({},h),b=1,P=1;if(e.query("IS_ACTIVE_VIEW","resize")){P=5,C=.9,M=1;var L=p.image.width,S=p.image.height;b=null===L&&null===S?p.crop.width/h.width:null===L?S/h.height:L/h.width;var G=h.width*b,D=h.height*b;O.x=O.x+(.5*h.width-.5*G),O.y=O.y+(.5*h.height-.5*D),O.width=G,O.height=D}c.originX=m.x,c.originY=m.y,c.translateX=g.x+v.x+A,c.translateY=g.y+v.y+I,c.scaleX=(y+E)*b,c.scaleY=(y+E)*b,c.rotateZ=_.main+_.sub+w,c.flipHorizontal=x.horizontal,c.flipVertical=x.vertical,l.animate=!d,l.opacity=C,l.container={left:T.left,top:T.top+n.offsetTop,width:T.width,height:T.height},l.rectangle={x:O.x+A,y:O.y+I,width:O.width,height:O.height},u.animate=!d,u.opacity=M,u.edgeWidth=P,u.rectangle={x:O.x+A,y:O.y+I,width:O.width,height:O.height}}})}),fn={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},dn=function(t,e,n,i,r){var o=null,a=!0,c={enabled:!0},u=function(t){var r=fn[t.keyCode]||t.keyCode;n[r]&&(t.stopPropagation(),a&&(o=e(r),a=!1),n[r](o),i(o))},l=function(t){var e=fn[t.keyCode]||t.keyCode;n[e]&&(t.stopPropagation(),r(o),a=!0)};return t.addEventListener("keydown",u),t.addEventListener("keyup",l),{enable:function(){c.enabled||(t.addEventListener("keydown",u),t.addEventListener("keyup",l)),c.enabled=!0},disable:function(){c.enabled&&(t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)),c.enabled=!1},destroy:function(){t.removeEventListener("keydown",u),t.removeEventListener("keyup",l)}}},hn=O({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(t){for(var e=t.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg">',i=0;i<=180;i+=2){var r=i*(176/180)-90+2,o=i%10==0?.5:.2;n+='<circle fill="currentColor" cx="'.concat(r,'" cy="').concat(0,'" r="').concat(o,'"/>'),i%10==0&&(n+='<text fill="currentColor" x="'.concat(r+(r<0?-2.25:0===r?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+i,"°</text>"))}n+="</svg>",e.element.innerHTML=n}}),pn=O({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity","translateY"],animations:{opacity:{type:"spring",damping:.5,mass:5},translateY:"spring"},apis:["rotation","animate"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("tabindex",0);var i=document.createElement("button");i.innerHTML="<span>".concat(e.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),i.className="doka--crop-rotator-center",i.addEventListener("click",function(){e.dispatch("CROP_IMAGE_ROTATE_CENTER")}),e.appendChild(i);var r=null;e.appendChildView(e.createChildView(function(t,e){return O({name:t,ignoreRect:!0,create:e})}("crop-rotator-line-mask",function(t){var e=t.root,n=t.props;r=e.appendChildView(e.createChildView(hn,{translateX:Math.round(312*n.rotation)}))}),n)),e.ref.line=r;var o=document.createElement("div");o.className="doka--crop-rotator-bar",e.appendChild(o);var a=Math.PI/4,c=0;e.ref.dragger=Qe(o,function(){c=r.translateX/312,e.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(t){var n=t.x/e.rect.element.width*(Math.PI/2),i=ut(c+n,-a,a);e.dispatch("CROP_IMAGE_ROTATE",{value:-i})},function(){e.dispatch("CROP_IMAGE_ROTATE_RELEASE")}),e.ref.keyboard=dn(e.element,function(){c=0},{left:function(){c+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},right:function(){c-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})}},function(){},function(){})},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.keyboard.destroy()},write:function(t){var e=t.root,n=t.props,i=t.timestamp,r=n.animate,o=n.rotation;r||0===o||(e.ref.line.translateX=null);var a=0,c=e.query("GET_CROP",n.id,i);if(c&&c.interaction&&c.interaction.rotation){var u=ue(c.interaction.rotation).sub-o;a=.025*Math.sign(u)*Math.log10(1+Math.abs(u)/.025)}e.ref.line.translateX=Math.round(312*(-o-a))}}),mn=["nw","ne","se","sw"],gn=["n","e","s","w"],vn=function(t){return gn[(gn.indexOf(t)+2)%gn.length]},yn=O({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),En=function(t,e,n){return O({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:en,translateY:en,scaleX:{type:"spring",delay:n},scaleY:{type:"spring",delay:n},opacity:{type:"spring",delay:e}}},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-corner"),n.element.setAttribute("role","button"),n.element.setAttribute("tabindex",-1),n.ref.dragger=Qe(n.element,function(){return n.dispatch("CROP_RECT_CORNER_DRAG_GRAB"),[t,function(t){return mn[(mn.indexOf(t)+2)%mn.length]}(t)]},function(t,e,i){n.dispatch("CROP_RECT_CORNER_DRAG",{offset:t,origin:e,anchor:i})},function(){n.dispatch("CROP_RECT_CORNER_DRAG_RELEASE")})},destroy:function(t){t.root.ref.dragger.destroy()}})},_n=O({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{apis:["rectangle","draft","rotating"]},create:function(t){var e=t.root;e.ref.wasRotating=!1,mn.forEach(function(t,n){var i=10*n,r=250+i+50,o=250+i;e.ref[t]=e.appendChildView(e.createChildView(En(t,r,o),{opacity:0,scaleX:.5,scaleY:.5}))}),gn.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(function(t){return O({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"]},create:function(e){var n=e.root;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button"),n.ref.dragger=Qe(n.element,function(){return n.dispatch("CROP_RECT_EDGE_DRAG_GRAB"),[t,vn(t)]},function(t,e,i){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:t,origin:e,anchor:i})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")}),n.ref.keyboard=dn(n.element,function(){return{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20}},function(e){n.dispatch("CROP_RECT_EDGE_DRAG",{offset:e,origin:t,anchor:vn(t)})},function(){n.dispatch("CROP_RECT_EDGE_DRAG_RELEASE")})},destroy:function(t){var e=t.root;e.ref.keyboard.destroy(),e.ref.dragger.destroy()}})}(t)))}),e.ref.lines=[];for(var n=0;n<10;n++)e.ref.lines.push(e.appendChildView(e.createChildView(yn,{opacity:0})));e.ref.animationDir=null},write:function(t){var e=t.root,n=t.props,i=n.rectangle,r=n.draft,o=n.rotating;if(i){var a=e.ref,c=a.n,u=a.e,l=a.s,s=a.w,f=a.nw,d=a.ne,h=a.se,p=a.sw,m=a.lines,g=a.animationDir,v=i.x,y=i.y,E=i.x+i.width,_=i.y+i.height,w=_-y,x=E-v,T=e.query("IS_ACTIVE_VIEW","crop");if(T&&"in"!==g?(e.ref.animationDir="in",mn.map(function(t){return e.ref[t]}).forEach(function(t){t.opacity=1,t.scaleX=1,t.scaleY=1})):T||"out"===g||(e.ref.animationDir="out",mn.map(function(t){return e.ref[t]}).forEach(function(t){t.opacity=0,t.scaleX=.5,t.scaleY=.5})),xn(r,f,v,y),xn(r,d,E,y),xn(r,h,E,_),xn(r,p,v,_),wn(r,c,v,y,x/100,1),wn(r,u,E,y,1,w/100),wn(r,l,v,_,x/100,1),wn(r,s,v,y,1,w/100),o){e.ref.wasRotating=!0;var R=m.slice(0,5),A=1/R.length;R.forEach(function(t,e){wn(r,t,v,y+w*(A+e*A),x/100,.01),t.opacity=.5});var I=m.slice(5);A=1/I.length,I.forEach(function(t,e){wn(r,t,v+x*(A+e*A),y,.01,w/100),t.opacity=.5})}else if(r){e.ref.wasRotating=!1;var C=m[0],M=m[1],O=m[2],b=m[3];wn(r,C,v,y+.333*w,x/100,.01),wn(r,M,v,y+.666*w,x/100,.01),wn(r,O,v+.333*x,y,.01,w/100),wn(r,b,v+.666*x,y,.01,w/100),C.opacity=.5,M.opacity=.5,O.opacity=.5,b.opacity=.5}else{var P=m[0],L=m[1],S=m[2],G=m[3];!e.ref.wasRotating&&P.opacity>0&&(wn(r,P,v,y+.333*w,x/100,.01),wn(r,L,v,y+.666*w,x/100,.01),wn(r,S,v+.333*x,y,.01,w/100),wn(r,G,v+.666*x,y,.01,w/100)),m.forEach(function(t){return t.opacity=0})}}}}),wn=function(t,e,n,i,r,o){t&&(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=rn(n),e.translateY=rn(i),e.scaleX=r,e.scaleY=o},xn=function(t,e,n,i){t&&(e.translateX=null,e.translateY=null),e.translateX=rn(n),e.translateY=rn(i)},Tn=function(t,e){if(!/svg/.test(t.namespaceURI)||"innerHTML"in t)t.innerHTML=e;else{var n=document.createElement("div");n.innerHTML="<svg>"+e+"</svg>";for(var i=n.firstChild;i.firstChild;)t.appendChild(i.firstChild)}},Rn=O({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-mask",tag:"svg",mixins:{styles:["opacity","translateX","translateY"],animations:{scale:en,maskWidth:en,maskHeight:en,translateX:en,translateY:en,opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","animate","maskWidth","maskHeight","scale"]},create:function(t){var e=t.root;e.customWriter=e.query("GET_CROP_MASK")(e.element,Tn)||function(){}},didWriteView:function(t){var e=t.root,n=t.props,i=n.maskWidth,r=n.maskHeight,o=n.scale;if(i&&r){e.element.setAttribute("width",rn(i)),e.element.setAttribute("height",rn(r));var a=e.query("GET_CROP_MASK_INSET");e.customWriter({x:o*a,y:o*a,width:i-o*a*2,height:r-o*a*2},{width:i,height:r})}}}),An=function(t,e){var n=t.childNodes[0];n?e!==n.nodeValue&&(n.nodeValue=e):(n=document.createTextNode(e),t.appendChild(n))},In=O({ignoreRect:!0,name:"crop-size",mixins:{styles:["translateX","translateY","opacity"],animations:{translateX:"spring",translateY:"spring",opacity:"spring"},listeners:!0},create:function(t){var e=t.root,n=m("span");n.className="doka--crop-size-info doka--crop-resize-percentage",e.ref.resizePercentage=n,e.appendChild(n);var i=m("span");i.className="doka--crop-size-info";var r=m("span");r.className="doka--crop-size-multiply",r.textContent="×";var o=m("span"),a=m("span");e.ref.outputWidth=o,e.ref.outputHeight=a,i.appendChild(o),i.appendChild(r),i.appendChild(a),e.appendChild(i),e.ref.previousValues={width:0,height:0,percentage:0}},write:function(t){var e=t.root,n=t.props,i=t.timestamp,r=e.query("GET_CROP",n.id,i);if(r){var o=r.cropStatus,a=e.ref,c=a.outputWidth,u=a.outputHeight,l=a.resizePercentage,s=a.previousValues,f=o.image,d=o.crop,h=Math.round(f.width||d.width),p=Math.round(f.height||d.height),m=f.width?Math.round(f.width/d.width*100):0;h!==s.width&&(An(c,h),s.width=h),p!==s.height&&(An(u,p),s.height=p),m!==s.percentage&&(f.width&&An(l,"".concat(m,"%")),s.percentage=m)}}}),Cn=O({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},apis:["id"],listeners:!0},tag:"button",create:function(t){var e=t.root,n=t.props;e.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),e.element.setAttribute("type",n.type||"button"),n.name&&n.name.split(" ").forEach(function(t){e.element.className+=" doka--button-".concat(t)}),e.ref.handleClick=function(t){"string"==typeof n.action?e.dispatch(n.action):n.action()},e.element.addEventListener("click",e.ref.handleClick),n.create&&n.create({root:e,props:n})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),Mn=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;return'<svg width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 ').concat(e," ").concat(e,'" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">').concat(t,"</svg>")},On=function(t){var e=t.root,n=t.props,i=t.timestamp,r=e.query("GET_CROP",n.id,i),o=e.ref.btnZoom;if(o){var a=r.cropRect;o.translateX=a.x+.5*a.width,o.translateY=a.y+.5*a.height}},bn=O({name:"crop-subject",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;e.opacity=1,e.query("GET_CROP_MASK")&&(e.ref.maskView=e.appendChildView(e.createChildView(Rn))),e.ref.cropView=e.appendChildView(e.createChildView(_n)),e.query("GET_CROP_SHOW_SIZE")&&(e.ref.cropSize=e.appendChildView(e.createChildView(In,{id:n.id,opacity:1,scaleX:1,scaleY:1,translateX:null}))),e.query("GET_CROP_ZOOM_TIMEOUT")||(e.ref.btnZoom=e.appendChildView(e.createChildView(ze("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:Cn,label:e.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:Mn('<g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g>',26),action:function(){return e.dispatch("CROP_ZOOM")}}]})))},write:b({CROP_RECT_EDGE_DRAG_RELEASE:On,CROP_RECT_CORNER_DRAG_RELEASE:On},function(t){var e=t.root,n=t.props,i=t.timestamp,r=e.query("GET_CROP",n.id,i);if(r){var o=e.ref,a=o.cropView,c=o.maskView,u=o.btnZoom,l=o.cropSize,s=r.cropRect,f=r.isRotating,d=r.isDraft,h=r.scale;if(e.query("IS_ACTIVE_VIEW","crop")){if(a.draft=d,a.rotating=f,a.rectangle=s,l){d&&(l.translateX=null,l.translateY=null);var p=Pn(e.rect.element,l.rect.element,s);l.translateX=d?p.x:rn(p.x),l.translateY=d?p.y:rn(p.y)}c&&(d&&(c.translateX=null,c.translateY=null,c.maskWidth=null,c.maskHeight=null),c.translateX=rn(s.x),c.translateY=rn(s.y),c.maskWidth=s.width,c.maskHeight=s.height,c.scale=h),u&&(u.opacity=r.canRecenter&&!r.isDraft?1:0)}}})}),Pn=function(t,e,n){var i=n.x,r=n.x+n.width,o=n.y+n.height,a=r-e.width-16,c=o-e.height-16;return e.width>n.width-32&&(a=i+(.5*n.width-.5*e.width),(c=o+16)>t.height-e.height&&(c=o-e.height-16)),{x:a=Math.max(0,Math.min(a,t.width-e.width)),y:c}},Ln=function(){return performance.now()},Sn=function(t,e){var n=function(t,e){for(;1===t.nodeType&&!e(t);)t=t.parentNode;return 1===t.nodeType?t:null}(e,function(t){return t.classList.contains("doka--root")});return!!n&&n.contains(t)},Gn=function(t){var e=t.root,n=t.props,i=t.action.position,r=n.pivotPoint,o=e.ref,a=o.indicatorA,c=o.indicatorB,u=r.x-i.x,l=r.y-i.y,s={x:r.x+u,y:r.y+l},f={x:r.x-u,y:r.y-l};a.style.cssText="transform: translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)"),c.style.cssText="transform: translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)")},Dn=function(t){return{x:t.pageX,y:t.pageY}},Un=O({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint"]},create:function(t){var e=t.root,n=t.props;e.ref.indicatorA=document.createElement("div"),e.appendChild(e.ref.indicatorA),e.ref.indicatorB=document.createElement("div"),e.appendChild(e.ref.indicatorB);var i=e.query("GET_CROP_RESIZE_KEY_CODES"),r={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},a=Ln();e.ref.state=r;var c=He(),u=0,l=!1;e.ref.resizeStart=function(t){if(0===c.count()&&(l=!1),c.push(t),Fe(document.documentElement,"up",e.ref.resizeEnd),Sn(e.element,t.target)&&c.multiple()){t.stopPropagation(),t.preventDefault();var n=c.active(),i=Dn(n[0]),r=Dn(n[1]);u=dt(i,r),Fe(document.documentElement,"move",e.ref.resizeMove),l=!0}},e.ref.resizeMove=function(t){if(l&&(t.preventDefault(),2===c.count())){c.update(t);var n=c.active(),i=Dn(n[0]),r=Dn(n[1]),o=(dt(i,r)-u)/u;e.dispatch("CROP_IMAGE_RESIZE",{value:o})}},e.ref.resizeEnd=function(t){c.pop(t);var n=0===c.count();n&&(je(document.documentElement,"move",e.ref.resizeMove),je(document.documentElement,"up",e.ref.resizeEnd)),l&&(t.preventDefault(),n&&e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},Fe(document.documentElement,"down",e.ref.resizeStart);var s=performance.now(),f=0,d=1,h=function(t,e){var n=null,i=null;return function(){var r=arguments;if(!i)return t.apply(null,Array.from(arguments)),void(i=Ln());clearTimeout(n),n=setTimeout(function(){Ln()-i>=e&&(t.apply(null,Array.from(r)),i=Ln())},e-(Ln()-i))}}(function(t){var n=Math.sign(t.wheelDelta||t.deltaY),i=Ln(),r=i-s;s=i,(r>750||f!==n)&&(d=1,f=n),d+=.05*n,e.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,d)}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},100);e.ref.wheel=function(t){/doka--/.test(t.target.className)&&Sn(e.element,t.target)&&(t.preventDefault(),h(t))},document.addEventListener("wheel",e.ref.wheel,{passive:!1}),e.ref.move=function(t){if(r.position.x=t.pageX-e.ref.state.offsetX,r.position.y=t.pageY-e.ref.state.scrollY-e.ref.state.offsetY,r.enabled)if(Sn(e.element,t.target)){"idle"===e.element.dataset.state&&e.dispatch("RESIZER_SHOW",{position:o({},r.position)}),t.preventDefault(),e.dispatch("RESIZER_MOVE",{position:o({},r.position)});var i=n.pivotPoint,c=i.x-r.position.x,l=i.y-r.position.y,s={x:i.x+c,y:i.y+l},f=o({},r.position);if(r.selecting){var d=(dt(s,f)-u)/u,h=performance.now();h-a>25&&(a=h,e.dispatch("CROP_IMAGE_RESIZE",{value:d}))}}else e.dispatch("RESIZER_CANCEL")},e.ref.select=function(t){if(Sn(e.element,t.target)){var i=n.pivotPoint,o=i.x-r.position.x,a=i.y-r.position.y,c={x:i.x+o,y:i.y+a},l=r.position;u=dt(c,l),r.selecting=!0,r.origin.x=t.pageX,r.origin.y=t.pageY,e.dispatch("CROP_IMAGE_RESIZE_GRAB")}},e.ref.confirm=function(t){Sn(e.element,t.target)&&(r.selecting=!1,e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},e.ref.blur=function(t){r.selecting=!1,r.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL")},window.addEventListener("blur",e.ref.blur),document.addEventListener("mousemove",e.ref.move),e.ref.keyDown=function(t){i.includes(t.keyCode)&&r.position&&(r.enabled=!0,document.addEventListener("mousedown",e.ref.select),document.addEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_SHOW",{position:o({},r.position)}))},e.ref.keyUp=function(t){i.includes(t.keyCode)&&(r.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",e.ref.keyDown),document.body.addEventListener("keyup",e.ref.keyUp)},destroy:function(t){var e=t.root;document.removeEventListener("touchmove",e.ref.resizeMove),document.removeEventListener("touchend",e.ref.resizeEnd),document.removeEventListener("touchstart",e.ref.resizeStart),document.removeEventListener("wheel",e.ref.wheel),document.removeEventListener("mousemove",e.ref.move),document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),document.body.removeEventListener("keydown",e.ref.keyDown),document.body.removeEventListener("keyup",e.ref.keyUp),window.removeEventListener("blur",e.ref.blur)},read:function(t){var e=t.root;e.ref.state.scrollY=window.scrollY;var n=e.element.getBoundingClientRect();e.ref.state.offsetX=n.x,e.ref.state.offsetY=n.y},write:b({RESIZER_SHOW:function(t){var e=t.root,n=t.props,i=t.action;e.element.dataset.state="multi-touch",Gn({root:e,props:n,action:i})},RESIZER_CANCEL:function(t){t.root.element.dataset.state="idle"},RESIZER_MOVE:Gn})}),Vn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"group",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["opacity"],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return O({ignoreRect:!0,name:t,mixins:{styles:["opacity"].concat(a(e)),animations:o({opacity:{type:"spring",stiffness:.25,damping:.5,mass:5}},n)},create:function(t){var e=t.root;t.props.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})},kn=O({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;n.options.map(function(t){var i=e.createChildView(Cn,o({},t,{action:function(){return e.dispatch(n.optionAction,{value:t.value})}}));return e.appendChildView(i)}),e.element.setAttribute("role","list"),e.ref.handleClick=function(){return n.action&&n.action()},e.element.addEventListener("click",e.ref.handleClick)},write:function(t){var e=t.root,n=t.props,i=(t.actions,n.options.findIndex(function(t){return t.value===n.selectedValue}));e.childViews.forEach(function(t,e){t.element.setAttribute("aria-selected",e===i)})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),Nn=O({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{apis:["selectedValue"]},create:function(t){var e=t.root,n=t.props;e.ref.open=!1;var i=function(t){e.ref.open=t,e.dispatch(n.buttonAction)};e.ref.button=e.appendChildView(e.createChildView(Cn,o({},n,{action:function(){i(!e.ref.open)}}))),e.ref.list=e.appendChildView(e.createChildView(kn,o({},n,{action:function(){i(!1)}}))),e.ref.handleBodyClick=function(t){e.element.contains(t.target)||i(!1)},e.element.addEventListener("focusin",function(t){t.target!==e.ref.button.element&&i(!0)}),e.element.addEventListener("focusout",function(t){e.element.contains(t.relatedTarget)||i(!1)}),document.body.addEventListener("click",e.ref.handleBodyClick)},destroy:function(t){var e=t.root;document.body.removeEventListener("click",e.ref.handleBodyClick)},write:function(t){var e=t.root,n=t.props;e.ref.list.opacity=e.ref.open?1:0,e.ref.list.translateY=e.ref.open?0:-5,e.ref.list.selectedValue=n.selectedValue}}),zn=O({name:"crop",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="crop",n.hidden=!1,e.ref.isHiding=!1;var i=[{view:Cn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:Mn('<g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g>',26),action:function(){return e.dispatch("CROP_IMAGE_ROTATE_LEFT")}},{view:Cn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:Mn('<g fill="currentColor" fill-rule="evenodd"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g>',26),action:function(){return e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}},{view:Cn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:Mn('<g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g></svg>',26),action:function(){return e.dispatch("CROP_IMAGE_FLIP_VERTICAL")}}],r=e.query("GET_CROP_ASPECT_RATIO_OPTIONS");r&&i.push({view:Nn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:Mn('<g class="doka--icon-aspect-ratio" fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g>',26),buttonAction:"TOGGLE_ASPECT_RATIO",optionAction:"CROP_SET_ASPECT_RATIO",options:r.map(function(t){return o({},t,{icon:function(t){var e,n;t>1?(n=14,e=Math.round(n/t)):(e=14,n=Math.round(e*t));var i=Math.round(.5*(23-e)),r=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><g fill="currentColor"><rect x="'.concat(i,'" y="').concat(r,'" width="').concat(e,'" height="').concat(n,'" rx="2.5"/></g></svg>')}(t.value)})}),didCreateView:function(t){e.ref.aspectRatioDropdown=t}}),e.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&i.splice(1,0,{view:Cn,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:Mn('<g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g>',26),action:function(){return e.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),e.ref.menu=e.appendChildView(e.createChildView(Vn("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:150}}),{opacity:0,controls:i})),e.menuItemsRequiredWidth=null,e.ref.subject=e.appendChildView(e.createChildView(bn,o({},n))),e.ref.rotator=e.appendChildView(e.createChildView(pn,{rotation:0,opacity:0,translateY:20,id:n.id})),e.ref.resizer=e.appendChildView(e.createChildView(Un,{pivotPoint:{x:0,y:0}}));var a=0,c=0;e.ref.keyboard=dn(e.element,function(){return a=0,c=0,{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20},plus:function(){a+=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:a}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){a-=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:a}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){c-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},right_bracket:function(){c+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},h:function(){e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){e.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){e.dispatch("CROP_RESET")},r:function(){e.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){e.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){e.dispatch("CROP_ZOOM")}},function(t){t&&e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(t){t&&e.dispatch("CROP_IMAGE_DRAG_RELEASE")})},read:function(t){var e=t.root,n=t.props;if(null===e.menuItemsRequiredWidth){var i=e.ref.menu.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.menuItemsRequiredWidth=0===i?null:i}var r=e.ref.subject.rect.element,o=r.left,a=r.top,c=r.width,u=r.height;n.stagePosition={x:o,y:a,width:c,height:u}},write:b({SHOW_VIEW:function(t){var e=t.root,n=t.action,i=t.props,r=e.ref,o=r.menu,a=r.rotator,c=r.subject;i.viewId===n.id?(c.opacity=1,o.opacity=1,a.opacity=1,a.translateY=0,i.hidden=!1,e.ref.isHiding=!1):(c.opacity=0,o.opacity=0,a.opacity=0,a.translateY=20,e.ref.isHiding=!0)},UNLOAD_IMAGE:function(t){var e=t.root.ref,n=e.menu,i=e.rotator;n.opacity=0,i.opacity=0,i.translateY=20},DID_PRESENT_IMAGE:function(t){var e=t.root,n=e.ref,i=n.menu,r=n.rotator;i.opacity=1,r.opacity=1,r.translateY=0;var o=e.query("GET_IMAGE");!function(t,e){Array.from(t.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(t){e>1&&(t.setAttribute("x",t.previousElementSibling?5:4),t.setAttribute("width",9)),e<1&&(t.setAttribute("y",11),t.setAttribute("height",10))})}(e,o.height/o.width)}},function(t){var e=t.root,n=t.props,i=t.timestamp,r=e.ref,o=r.resizer,a=r.subject,c=r.menu,u=r.rotator,l=r.isHiding,s=r.aspectRatioDropdown,f=n.hidden,d=0===a.opacity&&0===c.opacity&&0===u.opacity;if(!f&&l&&d&&(n.hidden=!0),!n.hidden){var h=e.query("GET_CROP",n.id,i);if(h){if(s){var p=e.query("GET_ACTIVE_CROP_ASPECT_RATIO");s.selectedValue!==p&&(function(t,e){var n=t.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!e)return n[0].style.opacity=.2,n[1].style.opacity=.3,void(n[2].style.opacity=.4);n[0].style.opacity=e>1?1:.3,n[1].style.opacity=1===e?.85:.5,n[2].style.opacity=e<1?1:.3}}(e,p),s&&(s.selectedValue=p))}o.pivotPoint={x:.5*o.rect.element.width,y:.5*o.rect.element.height},u.animate=!h.isDraft,u.rotation=h.rotation.sub,c.element.dataset.layout=e.menuItemsRequiredWidth>e.ref.menu.rect.element.width?"compact":"spacious"}}})}),Bn=O({name:"size-input",mixins:{listeners:!0,apis:["id","value","placeholder"]},create:function(t){var e=t.root,n=t.props,i=n.id,r=n.min,o=n.max,a=n.value,c=n.placeholder,u="doka--".concat(i),l=m("input",{type:"number",step:1,id:u,min:r,max:o,value:a,placeholder:c}),s=m("label",{for:u});s.textContent=n.label,e.ref.handleInput=function(){var t=l.getAttribute("max").length;l.value=l.value.replace(/[^0-9]/g,""),l.value.length>t&&(l.value=l.value.slice(0,t));var i=parseInt(l.value,10);i>o&&(i=o),l.value=i,n.value=ut(i,r,o)||null,e.dispatch("INPUT_VALUE",{id:n.id,value:n.value})},e.ref.handleBlur=function(){e.dispatch("BLUR_VALUE",{id:n.id,value:n.value})},l.addEventListener("input",e.ref.handleInput),l.addEventListener("blur",e.ref.handleBlur),e.appendChild(l),e.appendChild(s),e.ref.input=l},destroy:function(t){var e=t.root;e.ref.input.removeEventListener("input",e.ref.handleInput),e.ref.input.removeEventListener("blur",e.ref.handleBlur)},write:b({UPDATE_INPUT:function(t){var e=t.root,n=t.action,i=t.props;if(n.id===i.id){var r=n.value,o=e.ref.input;i.value=r,o.value=E(r)?Math.round(r):"",o.placeholder=i.placeholder}}})}),Yn=O({name:"checkable",tag:"span",mixins:{listeners:!0,apis:["id","checked","onchange"]},create:function(t){var e=t.root,n=t.props,i=n.id,r=n.checked,o=n.onchange,a=void 0===o?function(){}:o,c=m("input",{type:"checkbox",value:1,id:i});c.checked=r,e.ref.input=c;var u=m("label",{for:i});u.innerHTML=n.label,e.appendChild(c),e.appendChild(u),e.ref.handleChange=function(){n.checked=c.checked,a(n.checked),e.dispatch("INPUT_VALUE",{id:n.id,value:n.checked,checked:n.checked})},c.addEventListener("change",e.ref.handleChange)},destroy:function(t){var e=t.root;e.ref.input.removeEventListener("change",e.ref.handleChange)},write:b({UPDATE_INPUT:function(t){var e=t.root,n=t.action,i=t.props;if(n.id===i.id){var r=n.value,o=e.ref.input;i.checked=r,i.checked!==o.checked&&(o.checked=i.checked,i.onchange(i.checked))}}})}),Xn=null,Wn=null,Zn=O({ignoreRect:!0,name:"resize-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15,delay:150}}},create:function(t){var e=t.root;e.element.setAttribute("novalidate","novalidate"),e.element.setAttribute("action","#"),e.ref.shouldBlurKeyboard=(null===Xn&&(Xn=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),Xn||(null===Wn&&(Wn=/Android/i.test(navigator.userAgent)),Wn));var n=e;e.appendChildView(e.createChildView(qn("Image size",function(t){var e=t.root,i=e.query("GET_SIZE"),r=e.query("GET_SIZE_MIN"),o=e.query("GET_SIZE_MAX"),a=e.appendChildView(e.createChildView(Bn,{id:"image-width",label:"Width",value:E(i.width)?Math.round(i.width):null,min:r.width,max:o.width,placeholder:0})),c=function(t){var e=t?0:-3;l.element.querySelector(".doka--aspect-ratio-lock-ring").setAttribute("transform","translate(0 ".concat(e,")"))},u=e.query("GET_SIZE_ASPECT_RATIO_LOCK"),l=e.appendChildView(e.createChildView(Yn,{id:"aspect-ratio-lock",label:Mn('<g fill="none" fill-rule="evenodd"><path stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="doka--aspect-ratio-lock-ring" d="M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V14"/><rect fill="currentColor" x="7" y="10" width="10" height="7" rx="1.5"/></g>'),checked:u,onchange:c}));c(u);var s=e.appendChildView(e.createChildView(Bn,{id:"image-height",label:"Height",value:E(i.height)?Math.round(i.height):null,min:r.height,max:o.height,placeholder:0}));n.ref.aspectRatioLock=l,n.ref.inputImageWidth=a,n.ref.inputImageHeight=s}))),e.ref.buttonConfirm=e.appendChildView(e.createChildView(Cn,{name:"app action-confirm icon-only",label:"Apply",action:function(){},opacity:0,icon:Mn('><polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),type:"submit"})),e.ref.confirmForm=function(t){t.preventDefault(),e.ref.shouldBlurKeyboard&&(document.activeElement.blur(),e.ref.buttonConfirm.element.focus()),e.ref.buttonConfirm.opacity=0;var n=e.ref.inputImageWidth.value,i=e.ref.inputImageHeight.value;e.dispatch("RESIZE_SET_OUTPUT_SIZE",{width:n,height:i})},e.element.addEventListener("submit",e.ref.confirmForm)},destroy:function(t){var e=t.root;e.element.removeEventListener("submit",e.ref.confirmForm)},write:b({CROP_SET_ASPECT_RATIO:function(t){var e=t.root,n=t.props,i=t.action,r=t.timestamp,o=e.query("GET_CROP",n.id,r);if(o){var a=o.cropStatus,c=e.ref,u=c.inputImageWidth,l=c.inputImageHeight;null!==i.value?(e.dispatch("UPDATE_INPUT",{id:"image-width",value:a.image.width,placeholder:a.crop.width}),e.dispatch("UPDATE_INPUT",{id:"image-height",value:a.image.height,placeholder:a.crop.height})):u.value&&l.value&&e.dispatch("UPDATE_INPUT",{id:"image-height",value:null,placeholder:a.crop.height})}},INPUT_VALUE:function(t){var e=t.root,n=t.action,i=n.id,r=n.value,o=e.ref,a=o.inputImageWidth,c=o.inputImageHeight,u=o.aspectRatioLock,l=e.query("GET_CROP_RECTANGLE_ASPECT_RATIO"),s=u.checked,f=null,d=a.value,h=c.value;s?("image-width"===i&&(d=r,f={id:"image-height",value:h=null===r?null:a.value/l}),"image-height"===i&&(h=r,f={id:"image-width",value:d=null===r?null:c.value*l}),f&&e.dispatch("UPDATE_INPUT",f)):"image-width"!==i&&"image-height"!==i||("image-width"===i&&(d=r),"image-height"===i&&(h=r),null===d&&null===h&&e.dispatch("UPDATE_INPUT",{id:"aspect-ratio-lock",value:!0})),"aspect-ratio-lock"===i&&(c.value?e.dispatch("UPDATE_INPUT",{id:"image-width",value:c.value*l}):a.value&&e.dispatch("UPDATE_INPUT",{id:"image-height",value:a.value/l}),e.dispatch("RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK",{value:s}));var p=e.query("GET_SIZE_INPUT"),m=p.width,g=p.height,v=m!==d||g!==h;e.ref.buttonConfirm.opacity=v?1:0}},function(t){var e=t.root,n=t.props,i=t.timestamp,r=e.query("GET_CROP",n.id,i);if(r){var o=r.cropStatus,a=e.ref,c=a.inputImageWidth,u=a.inputImageHeight;null===c.value&&null===u.value?(c.element.firstChild.placeholder=o.crop.width,u.element.firstChild.placeholder=o.crop.height):null===u.value?u.element.firstChild.placeholder=Math.round(o.image.height):null===c.value&&(c.element.firstChild.placeholder=Math.round(o.image.width))}})}),qn=function(t,e){return O({tag:"fieldset",create:function(n){var i=n.root,r=m("legend");r.textContent=t,i.element.appendChild(r),e({root:i})}})},Hn={crop:zn,resize:O({name:"resize",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="resize",n.hidden=!1,e.ref.isHiding=!1,e.ref.form=e.appendChildView(e.createChildView(Zn,{opacity:0,id:n.id}))},read:function(t){var e=t.root,n=t.props,i=e.ref.form.rect,r=e.rect;n.stagePosition={x:r.element.left,y:r.element.top+i.element.height,width:r.element.width,height:r.element.height-i.element.height}},write:b({SHOW_VIEW:function(t){var e=t.root,n=t.action,i=t.props;n.id===i.viewId?(e.ref.isHiding=!1,e.ref.form.opacity=1,e.dispatch("CROP_ZOOM")):(e.ref.isHiding=!0,e.ref.form.opacity=0)}},function(t){var e=t.root,n=t.props,i=e.ref,r=i.form,o=i.isHiding,a=n.hidden;o&&0===r.opacity&&!a&&(n.hidden=!0)})})},Fn=O({name:"view-stack",ignoreRect:!0,create:function(t){var e=t.root;e.ref.activeView=null,e.ref.activeStagePosition=null,e.ref.shouldFocus=!1},write:b({SHOW_VIEW:function(t){var e=t.root,n=t.props,i=t.action,r=e.childViews.find(function(t){return t.viewId===i.id});r||(r=e.appendChildView(e.createChildView(Hn[i.id],o({},n)))),e.ref.activeView=r,e.childViews.map(function(t){return t.element}).forEach(function(t){t.dataset.viewActive="false",t.removeAttribute("tabindex")});var a=e.ref.activeView.element;a.dataset.viewActive="true",a.setAttribute("tabindex",-1),e.ref.shouldFocus=!0},DID_LOAD_IMAGE:function(t){var e=t.root;e.dispatch("CHANGE_VIEW",{id:e.query("GET_UTILS")[0]})}},function(t){var e=t.root,n=e.ref,i=n.activeView,r=n.previousStagePosition;if(i&&i.stagePosition&&(e.ref.shouldFocus&&(e.ref.activeView.element.focus({preventScroll:!0}),e.ref.shouldFocus=!1),function(t,e){return!t||!e||!function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}(t,e)}(i.stagePosition,r))){var o=i.stagePosition,a=o.x,c=o.y,u=o.width,l=o.height;if(0===u&&0===l)return;e.dispatch("DID_RESIZE_STAGE",{offset:{x:a,y:c},size:{width:u,height:l},animate:!0}),e.ref.previousStagePosition=i.stagePosition}})}),jn=O({name:"content",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;e.opacity=1,e.ref.viewStack=e.appendChildView(e.createChildView(Fn,{id:n.id})),e.ref.image=null},write:b({DID_PRESENT_IMAGE:function(t){t.root.ref.image.opacity=1},DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.image=e.appendChildView(e.createChildView(sn,{id:n.id}))}},function(t){var e=t.root,n=e.ref.image;n&&(n.offsetTop=e.rect.element.top)})}),Qn=O({name:"container",create:function(t){var e,n=t.root,i=[(e={view:Cn,didCreateView:function(t){return n.ref.btnReset=t},opacity:0,label:n.query("GET_LABEL_BUTTON_RESET")},r(e,"didCreateView",function(t){return n.ref.btnReset=t}),r(e,"name","app action-reset icon-only"),r(e,"icon",Mn('<g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g>',26)),r(e,"action",function(){return n.dispatch("EDIT_RESET")}),e)];n.query("GET_ALLOW_BUTTON_CANCEL")&&i.unshift({view:Cn,label:n.query("GET_LABEL_BUTTON_CANCEL"),name:"app action-cancel icon-fallback",opacity:1,icon:Mn('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></g>'),didCreateView:function(t){n.ref.btnCancel=t},action:function(){n.dispatch("EDIT_CANCEL")}}),n.ref.utilViews=[];var a=[],c={crop:{title:n.query("GET_LABEL_BUTTON_UTIL_CROP"),icon:Mn('<g transform="translate(3 3)" stroke="currentColor" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><circle cx="3" cy="3" r="3"/><circle cx="3" cy="15" r="3"/><path d="M17 1L5.12 12.88M11.47 11.48L17 17M5.12 5.12L9 9"/></g>')},resize:{title:n.query("GET_LABEL_BUTTON_UTIL_RESIZE"),icon:Mn('<g fill="none" fill-rule="evenodd" stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M2 14a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2"/><rect x="2" y="2" width="20" height="20" rx="2"/><path d="M14 10l3.365-3.365M14 6h4v4" class="doka--icon-resize-arrow-ne"/><path d="M14 10l3.365-3.365M14 6v4h4" class="doka--icon-resize-arrow-sw"/></g>')}};if(n.query("GET_UTILS").forEach(function(t){var e=c[t];e&&a.push(o({id:t},e))}),a.length>1){var u=Vn("utils");i.push({view:u,opacity:1,controls:a.map(function(t){return{view:Cn,label:t.title,name:"tab",opacity:1,icon:t.icon,id:t.id,didCreateView:function(e){n.ref.utilViews.push(e),n.ref["util_button_".concat(t.id)]=e},action:function(){return n.dispatch("CHANGE_VIEW",{id:t.id})}}})})}n.query("GET_ALLOW_BUTTON_CONFIRM")&&i.push({view:Cn,label:n.query("GET_LABEL_BUTTON_CONFIRM"),name:"app action-confirm icon-fallback",opacity:1,icon:Mn('<polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),didCreateView:function(t){n.ref.btnConfirm=t},action:function(){n.dispatch("EDIT_CONFIRM")}}),n.ref.menu=n.appendChildView(n.createChildView(Vn("menu"),{controls:i})),n.ref.menu.opacity=0,n.ref.status=n.appendChildView(n.createChildView(Ze)),n.dispatch("AWAIT_IMAGE"),n.ref.handleFocusOut=function(){var t=n.ref.status;"busy"===t.element.dataset.viewStatus&&t.element.focus()},n.ref.handleFocusIn=function(t){var e=n.ref,i=e.menu,r=e.content,o=t.target;if(!i.element.contains(o)&&r&&r.element.contains(o)){if(!Array.from(n.element.querySelectorAll("[data-view-active=false]")).reduce(function(t,e){return e.contains(o)&&(t=!0),t},!1))return;i.element.querySelector("button,input,[tabindex]").focus()}},n.element.addEventListener("focusin",n.ref.handleFocusIn),n.element.addEventListener("focusout",n.ref.handleFocusOut)},destroy:function(t){var e=t.root;e.element.removeEventListener("focusin",e.ref.handleFocusIn),e.element.removeEventListener("focusout",e.ref.handleFocusOut)},write:b({SHOW_VIEW:function(t){var e=t.root,n=t.action;e.ref.utilViews.forEach(function(t){return t.element.dataset.active=t.id===n.id})},UNLOAD_IMAGE:function(t){var e=t.root;e.ref.content&&(e.ref.content.opacity=0,e.ref.menu.opacity=0)},DID_UNLOAD_IMAGE:function(t){var e=t.root;e.removeChildView(e.ref.content),e.ref.content=null},DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.content=e.appendChildView(e.createChildView(jn,{opacity:null,id:n.id})),e.ref.menu.opacity=1}},function(t){var e=t.root,n=t.props,i=t.timestamp,r=e.query("GET_CROP",n.id,i);if(r){var o=e.ref,a=o.btnCancel,c=o.content,u=o.util_button_resize,l=r.canReset,s=r.cropStatus;if(e.ref.btnReset.opacity=l?1:0,a&&e.query("GET_UTILS").length>1){var f=e.query("GET_ROOT");a.opacity=l&&f.width<600?0:1}u&&function(t,e){t.element.dataset.scaleDirection=null===e||e>1?"up":"down"}(u,s.image.width?s.image.width/s.crop.width:null),c&&0===c.opacity&&e.dispatch("DID_UNLOAD_IMAGE")}})}),Kn=function(t){return t.preventDefault()},Jn=O({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(t){var e=t.root,n=t.props;n.markedForRemoval=!1,e.element.addEventListener("touchmove",Kn,{passive:!1}),e.element.addEventListener("gesturestart",Kn),e.ref.pointerPolyfill=function(t){var e={destroy:function(){}};if("onpointerdown"in window)return e;var n=0,i=[],r=function(t,e,n){var i=new UIEvent(e.type,{view:window,bubbles:!n});Object.keys(e).forEach(function(t){Object.defineProperty(i,t,{value:e[t],writable:!1})}),t.dispatchEvent(i)},o=function(t,e,o){return Array.from(e.changedTouches).map(function(a){var c=i[a.identifier],u={type:t,pageX:a.pageX,pageY:a.pageY,pointerId:a.identifier,isPrimary:c?c.isPrimary:0===n,preventDefault:function(){return e.preventDefault()}};return r(a.target,u,o),u})},a=function(t){o("pointerdown",t).forEach(function(t){i[t.pointerId]=t,n++})},c=function(t){o("pointermove",t)},u=function(t){o("pointerup",t).forEach(function(t){delete i[t.pointerId],n--})},l=function(t,e,n){var i={type:t,pageX:e.pageX,pageY:e.pageY,pointerId:0,isPrimary:!0,preventDefault:function(){return e.preventDefault()}};return r(e.target,i,n),i},s=function(t){l("pointerdown",t)},f=function(t){l("pointermove",t)},d=function(t){l("pointerup",t)};return"ontouchstart"in window?(t.addEventListener("touchstart",a),t.addEventListener("touchmove",c),t.addEventListener("touchend",u)):"onmousedown"in window&&(t.addEventListener("mousedown",s),t.addEventListener("mousemove",f),t.addEventListener("mouseup",d)),e.destroy=function(){i.length=0,t.removeEventListener("touchstart",a),t.removeEventListener("touchmove",c),t.removeEventListener("touchend",u),t.removeEventListener("mousedown",s),t.removeEventListener("mousemove",f),t.removeEventListener("mouseup",d)},e}(e.element),e.appendChildView(e.createChildView(Qn,o({},n)))},destroy:function(t){var e=t.root;e.ref.pointerPolyfill.destroy(),e.element.removeEventListener("touchmove",Kn,!0),e.element.removeEventListener("gesturestart",Kn)}}),$n=function(t){return t.ref.isFullscreen},ti=function(t){return/fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE"))},ei=function(t){return/fullscreen|preview/.test(t.query("GET_STYLE_LAYOUT_MODE"))},ni=function(t){return t.query("GET_ALLOW_AUTO_CLOSE")},ii=ei,ri=ei,oi=function(t){var e=t.ref,n=e.environment,i=e.isSingleUtil,r=e.canBeControlled;t.element.dataset.styleViewport=li(t.rect.element.width,t.rect.element.height)+" "+n.join(" ")+(i?" single-util":" multi-util")+(r?" flow-controls":" no-flow-controls")},ai=function(t){var e=t.element,n=t.ref,i=n.handleFullscreenUpdate,r=n.handleEscapeKey;e.setAttribute("tabindex",-1),i(),t.ref.focusTrap=function(t){var e=function(e){if(9===e.keyCode){var n=Array.from(t.querySelectorAll("button,input,[tabindex]")).filter(function(t){return"hidden"!==t.style.visibility&&-1!==t.tabIndex}),i=n[0],r=n[n.length-1];e.shiftKey?document.activeElement===i&&(r.focus(),e.preventDefault()):document.activeElement===r&&(i.focus(),e.preventDefault())}};return t.addEventListener("keydown",e),{destroy:function(){t.removeEventListener("keydown",e)}}}(e),e.addEventListener("keydown",r),window.addEventListener("resize",i),document.body.classList.add("doka--parent"),document.body.appendChild(e),document.body.style.minHeight="512px";var o=document.querySelector("meta[name=viewport]");t.ref.defaultViewportContent=o?o.getAttribute("content"):null,o||((o=document.createElement("meta")).setAttribute("name","viewport"),document.head.appendChild(o)),o.setAttribute("content","width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0"),t.opacity=1,t.element.contains(document.activeElement)||e.focus(),t.dispatch("INVALIDATE_VIEWPORT"),t.ref.isFullscreen=!0},ci=function(t){var e=t.element,n=t.ref,i=n.handleFullscreenUpdate,r=n.focusTrap,o=n.handleEscapeKey;e.removeAttribute("tabindex"),r.destroy(),e.removeEventListener("keydown",o),window.removeEventListener("resize",i),document.body.classList.remove("doka--parent");var a=document.querySelector("meta[name=viewport]");t.ref.defaultViewportContent?(a.setAttribute("content",t.ref.defaultViewportContent),t.ref.defaultViewportContent=null):a.parentNode.removeChild(a),t.ref.isFullscreen=!1},ui=O({name:"root",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(t){var e=t.root,n=t.props;e.element.id=e.query("GET_ID")||"doka-".concat(n.id),e.ref.environment=[],e.ref.shouldBeDestroyed=!1,e.ref.isClosing=!1,e.ref.isClosed=!1,e.ref.isFullscreen=!1,e.query("GET_ALLOW_DROP_FILES")&&(e.ref.catcher=function(t){var e=o({},j(),{destroy:function(){t.removeEventListener("dragover",n),t.removeEventListener("drop",i)}}),n=function(t){return t.preventDefault()},i=function(t){t.preventDefault();var n=Array.from(t.dataTransfer.items||t.dataTransfer.files).map(function(t){return t.getAsFile&&"file"===t.kind?t.getAsFile():t});e.fire("drop",n)};return t.addEventListener("dragover",n),t.addEventListener("drop",i),e}(e.element),e.ref.catcher.on("drop",function(t){t.forEach(function(t){e.dispatch("REQUEST_LOAD_IMAGE",{source:t})})})),e.ref.touchDetector=function(){function t(){e.fire("touch-detected"),window.removeEventListener("touchstart",t,!1)}var e=o({},j(),{destroy:function(){window.removeEventListener("touchstart",t,!1)}});return window.addEventListener("touchstart",t,!1),e}(),e.ref.touchDetector.onOnce("touch-detected",function(){e.ref.environment.push("touch")}),e.ref.editor=e.appendChildView(e.createChildView(Jn,{id:n.id})),e.query("GET_STYLES").filter(function(t){return!L(t.value)}).map(function(t){var n=t.name,i=t.value;e.element.dataset[n]=i}),e.ref.updateViewport=function(){e.dispatch("INVALIDATE_VIEWPORT")},window.addEventListener("resize",e.ref.updateViewport),e.ref.isSingleUtil=1===e.query("GET_UTILS").length,e.ref.canBeControlled=e.query("GET_ALLOW_BUTTON_CONFIRM")||e.query("GET_ALLOW_BUTTON_CANCEL"),oi(e);var i=document.createElement("div");i.style.cssText="position:fixed;height:100vh;top:0;",e.ref.measure=i,document.body.appendChild(i),e.ref.handleEscapeKey=function(t){27===t.keyCode&&e.dispatch("EDIT_CANCEL")},e.ref.initialScreenMeasureHeight=null,e.ref.handleFullscreenUpdate=function(){e.element.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight},e.ref.clientRect={left:0,top:0}},read:function(t){var e=t.root,n=e.ref.measure;n&&(e.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),e.ref.measure=null),e.ref.clientRect=e.element.getBoundingClientRect()},write:b({ENTER_FULLSCREEN:function(t){var e=t.root;ai(e)},EXIT_FULLSCREEN:function(t){var e=t.root;ci(e)},SHOW_VIEW:function(t){var e=t.root,n=t.action;e.element.dataset.view=n.id},DID_SET_STYLE_LAYOUT_MODE:function(t){var e=t.root,n=t.action;e.element.dataset.styleLayoutMode=n.value||"none",/fullscreen/.test(n.value)&&!/fullscreen/.test(n.prevValue)&&e.dispatch("ENTER_FULLSCREEN")},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root;if(0===e.opacity&&(e.opacity=1),e.ref.isClosing=!1,e.ref.isClosed=!1,!ti(e)||$n(e)){var n=e.query("GET_STYLE_LAYOUT_MODE");null!==n&&"modal"!==n||e.element.parentNode||e.dispatch("SET_STYLE_LAYOUT_MODE",{value:("fullscreen "+(n||"")).trim()})}else e.dispatch("ENTER_FULLSCREEN")},DID_CANCEL:function(t){var e=t.root;ii(e)&&ni(e)&&e.dispatch("EDIT_CLOSE")},DID_CONFIRM:function(t){var e=t.root;ii(e)&&ni(e)&&e.dispatch("EDIT_CLOSE")},EDIT_CLOSE:function(t){var e=t.root;ri(e)&&(e.opacity=e.opacity||1,e.opacity=0,e.ref.isClosed=!1,e.ref.isClosing=!0,e.query("GET_ALLOW_AUTO_DESTROY")&&(e.ref.shouldBeDestroyed=!0),$n(e)&&e.dispatch("EXIT_FULLSCREEN"))}},function(t){var e=t.root;oi(e);var n=e.query("GET_ROOT"),i=e.rect.element;n.width===i.width&&n.height===i.height||e.dispatch("UPDATE_ROOT_RECT",{rect:{x:e.ref.clientRect.left,y:e.ref.clientRect.top,left:e.ref.editor.rect.element.left,top:e.ref.editor.rect.element.top,width:e.rect.element.width,height:e.rect.element.height}})}),didWriteView:function(t){var e=t.root,n=e.ref,i=n.isClosed,r=n.isClosing,o=n.shouldBeDestroyed;!i&&r&&0===e.opacity&&(e.dispatch("DID_CLOSE"),e.ref.isClosed=!0,e.ref.isClosing=!1,ti(e)&&e.element.parentNode&&document.body.removeChild(e.element),o&&e.dispatch("EDIT_DESTROY"))},destroy:function(t){var e=t.root;$n(e)&&ci(e),ti(e)&&e.element.parentNode&&document.body.removeChild(e.element),window.removeEventListener("resize",e.ref.updateViewport),e.ref.touchDetector.destroy(),e.ref.catcher&&e.ref.catcher.destroy()}}),li=function(t,e){var n="";return 0===t&&0===e?"detached":(n+=e>t?"portrait":"landscape",(n+=t<=600?" x-cramped":t<=1e3?" x-comfortable":" x-spacious").trim())},si=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=ot(),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=o({},t),r=[],a=[],c=function(t,e,n){n?a.push({type:t,data:e}):(f[t]&&f[t](e),r.push({type:t,data:e}))},u=function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return s[t]?(e=s)[t].apply(e,i):null},l={getState:function(){return o({},i)},processActionQueue:function(){var t=r.concat();return r.length=0,t},processDispatchQueue:function(){var t=a.concat();a.length=0,t.forEach(function(t){var e=t.type,n=t.data;c(e,n)})},dispatch:c,query:u},s={};e.forEach(function(t){s=o({},t(i),s)});var f={};return n.forEach(function(t){f=o({},t(c,u,i),f)}),l}(function(t){var e={noImageTimeout:null,options:W(t)};return Z(e),e}(e),[Xt,function(t){return function(e){var n={};return s(t,function(t){n["GET_".concat(q(t,"_").toUpperCase())]=function(n){return e.options[t]}}),n}}(e)],[Ne,function(t){return function(e,n,i){var r={};return s(t,function(t){var n=q(t,"_").toUpperCase();r["SET_".concat(n)]=function(r){var o;try{o=i.options[t],i.options[t]=r.value}catch(t){}e("DID_SET_".concat(n),{value:i.options[t],prevValue:o})}}),r}}(e)]);n.dispatch("SET_OPTIONS",{options:t});var i=F(),r=null,a=ui(n,{id:i}),c=!1,d={_read:function(){c||a._read()},_write:function(t){var e=n.processActionQueue().filter(function(t){return!/^SET_/.test(t.type)});c&&!e.length||(m(e),(c=a._write(t,e))&&n.processDispatchQueue(),e.find(function(t){return"EDIT_DESTROY"===t.type})&&g())}},h=function(t){return function(e){var n={type:t};return e?(n.output=e.output,e.hasOwnProperty("error")&&(n.error=e.error?o({},e.error):null),n):n}},p={DID_CONFIRM:h("confirm"),DID_CANCEL:h("cancel"),DID_LOAD_IMAGE:h("load"),DID_CLOSE:h("close"),DID_DESTROY:h("destroy"),DID_INIT:h("init")},m=function(t){t.length&&t.forEach(function(t){if(p[t.type]){var e=p[t.type];(Array.isArray(e)?e:[e]).forEach(function(e){setTimeout(function(){!function(t){var e=o({doka:v},t);delete e.type,a&&a.element.dispatchEvent(new CustomEvent("Doka:".concat(t.type),{detail:e,bubbles:!0,cancelable:!0,composed:!0}));var i=[];t.hasOwnProperty("error")&&i.push(t.error);var r=["type","error"];Object.keys(t).filter(function(t){return!r.includes(t)}).forEach(function(e){return i.push(t[e])}),v.fire.apply(v,[t.type].concat(i));var c=n.query("GET_ON".concat(t.type.toUpperCase()));c&&c.apply(void 0,i)}(e(t.data))},0)})}})},g=function(){v.fire("destroy",a.element),a._destroy(),n.dispatch("DID_DESTROY")},v=o({},j(),d,function(t,e){var n={};return s(e,function(i){var r=U(e[i])?e[i]:i;n[i]={get:function(){return H(i,r),t.getState().options[r]},set:function(e){H(i,r),t.dispatch("SET_".concat(q(r,"_").toUpperCase()),{value:e})}}}),n}(n,e),{setOptions:function(t){return n.dispatch("SET_OPTIONS",{options:t})},setData:function(t){n.dispatch("SET_DATA",t)},getData:function(t){return new Promise(function(e,i){n.dispatch("GET_DATA",o({},t,{success:e,failure:i}))})},open:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(i,r){t&&n.dispatch("REQUEST_LOAD_IMAGE",{source:t,options:e,success:i,failure:r,resolveOnConfirm:!!e&&e.resolveOnConfirm})})},edit:function(t,e){return v.open(t,o({},e,{resolveOnConfirm:!0}))},save:function(t){return new Promise(function(e,i){n.dispatch("GET_DATA",o({},t,{success:e,failure:i}))})},clear:function(){return n.dispatch("REQUEST_REMOVE_IMAGE")},close:function(){return n.dispatch("EDIT_CLOSE")},destroy:g,insertBefore:function(t){u(a.element,t)},insertAfter:function(t){l(a.element,t)},appendTo:function(t){t.appendChild(a.element)},replaceElement:function(t){u(a.element,t),t.parentNode.removeChild(t),r=t},restoreElement:function(){r&&(l(r,a.element),a.element.parentNode.removeChild(a.element),r=null)},isAttachedTo:function(t){return!!a&&(a.element===t||r===t)},element:{get:function(){return a?a.element:null}}});return n.dispatch("DID_INIT"),f(v)},fi=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=ot(),n={};return s(e,function(t,e){U(e)||(n[t]=e[0])}),s(t,function(t){U(e[t])&&H(t,e[t])}),si(o({},n,t))},di=function(t){return"object"===i(t)&&null!==t},hi=function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.replace(new RegExp("".concat(e,"."),"g"),function(t){return t.charAt(1).toUpperCase()})}(t.replace(/^data-/,""))},pi=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];s(t.attributes,function(e){return n.push(t.attributes[e])});var i=n.filter(function(t){return t.name}).reduce(function(e,n){var i=d(t,n.name);return e[hi(n.name)]=i===n.name||i,e},{});return function t(e,n){s(n,function(n,i){s(e,function(t,r){var o=new RegExp(n);if(o.test(t)&&(delete e[t],!1!==i))if(U(i))e[i]=r;else{var a=i.group;di(i)&&!e[a]&&(e[a]={}),e[a][function(t){return t.charAt(0).toLowerCase()+t.slice(1)}(t.replace(o,""))]=r}}),i.mapping&&t(e[i.group],i.mapping)})}(i,e),i},mi=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return t instanceof HTMLElement}(e[0])?function(t){var e=o({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=pi(t,{"^class$":"className"});Object.keys(n).forEach(function(t){di(n[t])?(di(e[t])||(e[t]={}),Object.assign(e[t],n[t])):e[t]=n[t]}),"CANVAS"!==t.nodeName&&"IMG"!==t.nodeName||(e.src=t.dataset.dokaSrc?t.dataset.dokaSrc:t);var i=fi(e);return i.replaceElement(t),i}.apply(void 0,e):fi.apply(void 0,a(e.filter(function(t){return t})))},gi=["fire","_read","_write"],vi=function(t){var e={};return function(t,e,n){Object.getOwnPropertyNames(t).filter(function(t){return!n.includes(t)}).forEach(function(n){return Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}(t,e,gi),e},yi=function(){var t=rt()&&!("[object OperaMini]"===Object.prototype.toString.call(window.operamini))&&"visibilityState"in document&&"Promise"in window&&"slice"in Blob.prototype&&"URL"in window&&"createObjectURL"in window.URL&&"performance"in window;return function(){return t}}(),Ei={apps:[]},_i=function(){},wi={},xi=_i,Ti=_i,Ri=_i,Ai=_i,Ii=_i,Ci=_i;if(yi()){!function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,i="__framePainter";if(window[i])return window[i].readers.push(t),void window[i].writers.push(e);window[i]={readers:[t],writers:[e]};var r=window[i],o=1e3/n,a=null,c=null;(function t(e){c=window.requestAnimationFrame(t),a||(a=e);var n=e-a;n<=o||(a=e-n%o,r.readers.forEach(function(t){return t()}),r.writers.forEach(function(t){return t(e)}))})(performance.now())}(function(){Ei.apps.forEach(function(t){return t._read()})},function(t){Ei.apps.forEach(function(e){return e._write(t)})});var Mi=function t(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:yi,create:xi,destroy:Ti,parse:Ri,find:Ai,setOptions:Ci}})),document.removeEventListener("DOMContentLoaded",t)};"loading"!==document.readyState?setTimeout(function(){return Mi()},0):document.addEventListener("DOMContentLoaded",Mi);e.OptionTypes=wi={},s(ot(),function(t,e){wi[t]=e[1]}),e.create=xi=function(){var t=mi.apply(void 0,arguments);return t.on("destroy",Ti),Ei.apps.push(t),vi(t)},e.destroy=Ti=function(t){var e=Ei.apps.findIndex(function(e){return e.isAttachedTo(t)});return e>=0&&(Ei.apps.splice(e,1)[0].restoreElement(),!0)},e.parse=Ri=function(t){return Array.from(t.querySelectorAll(".".concat("doka"))).filter(function(t){return!Ei.apps.find(function(e){return e.isAttachedTo(t)})}).map(function(t){return xi(t)})},e.find=Ai=function(t){var e=Ei.apps.find(function(e){return e.isAttachedTo(t)});return e?vi(e):null},e.getOptions=Ii=function(){var t={};return s(ot(),function(e,n){t[e]=n[0]}),t},e.setOptions=Ci=function(t){return di(t)&&(Ei.apps.forEach(function(e){e.setOptions(t)}),function(t){s(t,function(t,e){ct[t]&&at(t,e)})}(t)),Ii()}}e.supported=yi,e.OptionTypes=wi,e.create=xi,e.destroy=Ti,e.parse=Ri,e.find=Ai,e.getOptions=Ii,e.setOptions=Ci}]);